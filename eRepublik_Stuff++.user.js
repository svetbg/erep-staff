// ==UserScript==
// @name		eRepublik Stuff++
// @version		3.11
// @include		*www.erepublik.com*
// @grant		none
// @run-at		document-start
// ==/UserScript==
function ಠ_ಠ(){function t(t){X("head").append("<style>"+t+"</style>")}function e(t){return(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function i(){t("#NoKills{cursor:default;font:bold 11px arial;float:left;width:145px;margin:0 3px}#NoKills strong{color:#666}#NoKills span{color:#3c8fa7;float:right}"),X("#NoKills").remove(),X("#eRS_settings").before('<div id="NoKills" title="Click to reset stats"><strong>Kills today:</strong><span>'+e(K.stats[0])+"</span><br><strong>Hits:</strong><span>"+e(K.stats[1])+"</span><br><strong>Damage:</strong><span>"+e(K.stats[2])+"</span></div>"),X("#NoKills").tipsy({gravity:"e"}).click(function(){X(".tipsy").hide(),_()})}function a(){setTimeout(a,1e3),X("#maxRecover").remove(),X("#current_health").after('<strong id="maxRecover" style="text-align:right;margin-right:5px;width:98%;background:none">'+food_remaining+"</strong>")}function n(){function t(t){return 10>t?"0"+t:t}setTimeout(n,1e3),X("#full_energy").remove()
var e=Math.max(360*Math.ceil((reset_health_to_recover-food_remaining)/globalNS.userInfo.energyPerInterval)-360+60*parseInt(X("#foodResetHours").text()),0)
X("#current_health").before('<strong id="full_energy" style="text-align:left;left:'+(Q?5:15)+'px;background:none">'+t(parseInt(e/3600))+":"+t(parseInt(e%3600/60))+"</strong>").css("padding-left",Q?"10px":0)}function o(){t("#sideInventory{position:absolute;background:#FFF;display:none}#sideInventory img,#sideInventory span{float:left;clear:both}#sideInventory img{width:39px;height:39px;background:linear-gradient(#EEF1EC,#D5DECF)}#sideInventory span{font:bold 10px arial;color:#578B4D;background:linear-gradient(#BEE698,#98D780);width:39px;text-align:center;cursor:default}.col{line-height:19px}#storageCapacity{float:left;color:#585858;font-size:11px;cursor:default}#storageCapacity img{float:left;margin:-1px 6px 0 2px;width:22px;height:16px}#storageCapacity span{margin:0!important;cursor:pointer}"),X(".currency_amount").after('<div id="storageCapacity"><img '+B("modules/manager/tab_storage.png")+"><span>Click to load storage</span></div>"),X("#storageCapacity span").click(function(){var t=X(this).text("Loading...")
X.get("/"+G+"/economy/inventory",function(i){t.remove()
var a=i.replace(/src=/g,"tmpsrc="),n=0,o=0
X("body").prepend('<div id="sideInventory"></div>'),X(".item_mask ul li,.bazooka .item",a).each(function(){var t=X("strong",this).text()
if(0!==+t){var e=X("strong",this).attr("id")?X("strong",this).attr("id").split("stock_")[1]:"",i=(X("#product_details_"+e+" .attributes",a).html()||"")+(X("#product_details_"+e+" .extra",a).html()||""),r=e.split("_")
1==r[0]&&(r[1]<8?n+=+t.replace(/,/g,"")*(r[1]<7?2*r[1]:20):o+=+t.replace(/,/g,"")*(10==r[1]?10:11==r[1]?20:0)),X(this).parent().hasClass("bazooka")&&X(".b_parts li",a).each(function(){i+=X(this).attr("title")+': <span class="col defense">'+X("strong",this).text()+"</span></br>"}),X("#sideInventory").append('<img title="'+i.replace(/"/g,"'")+'"'+B(X("img",this).attr("tmpsrc").split("/images/")[1])+"><span>"+(X(".timer",this).length?parseInt(X(".timer",this).attr("data-duration")/3600)+"h":t)+"</span>")}}),X("#sell_offers tr",a).each(function(){if(X('.offer_image[tmpsrc*="industry/1/q"]',this).length){var t=+X(".offer_image",this).attr("tmpsrc").split("industry/1/q")[1].split("_")[0]
n+=+X(".offer_amount",this).text().replace(/,/g,"")*(7>t?2*t:20)}}),X("#sideInventory img").tipsy({gravity:"w",html:!0}).parent().fadeIn(500)
var r=X(".area.storage h4:first strong",a).text().replace(/[,()]/g,"").split("/")
X("#storageCapacity").attr("title",'Free space: <span class="col defense">'+e(r[1]-r[0])+'</span><br>Total food HP: <span class="col defense">'+e(n)+'</span><br> Total EB hits: <span class="col defense">'+e(o)+"</span>").append("<strong>"+e(r[0])+" / "+e(r[1])+"</strong>").tipsy({gravity:"e",html:!0}),location.href.indexOf(Y)>-1&&X("#InfCalc_hits").val(o).keyup()})})}function r(){function t(){"AUTOBOT ON"==X("#AutoBotSwitch").text()||!K.lvlUpNoRecovery&&globalNS.userInfo.wellness+food_remaining>10*(X("#experienceTooltip strong:eq(2)").text()-X("#experienceTooltip strong:eq(1)").text())||globalNS.userInfo.wellness>=reset_health_to_recover||food_remaining<smallestFood.use||X.getJSON("/"+G+"/main/eat?format=json&_token="+SERVER_DATA.csrfToken+"&buttonColor=blue",function(t){energy.processResponse(t)})}t()
var e=setInterval(t,3e3)
X("#fight_btn").click(function(){clearInterval(e),e=setInterval(t,3e3)})}function s(){function e(t,e){return'<li><a href="/'+G+"/economy/marketplace#"+Z+"/"+t+"/"+e+'"><img'+B("icons/industry/"+t+"/"+(t>4?"default":"q"+e)+".png")+"> "+(1==t?"Food Q"+e:2==t?"Weapons Q"+e:3==t?"Tickets Q"+e:4==t?"Houses Q"+e:7==t?"Food Raw":12==t?"Weapon Raw":"House Raw")+"</a></li>"}t(".eRS_quickMarket{display:none;position:relative;top:-62px}.eRS_quickMarket img{width:18px;height:20px;vertical-align:middle;margin-bottom:2px}#menu4 ul li:nth-child(1):hover > .eRS_quickMarket{display:block}")
for(var i="",a=1;5>a;a++){i+='<div class="eRS_quickMarket" style="'+(1==a?"right:401px":2==a?"right:264px":3==a?"":"left:138px")+'"><ul>'
for(var n=1;8>=n;n++)i+=1==a&&8==n?e(7,1):2==a&&8==n?e(12,1):4==a&&6==n?e(17,1):3==a&&n>5||4==a&&n>6?"":e(a,n)
i+="</ul></div>"}X("#menu4 ul li:eq(0)").append(i).find("a").click(function(){location.href=this.href,location.reload()})}function l(){t("#changeAll{cursor:pointer;background:#83B70B;border:1px;color:#fff;font:bold 11px arial;height:24px}#changeAll:hover{background:#FB7E3D}#eRS_same_all{margin:0 5px;width:40px;text-align:right}"),X(".area h4").append('<div style="float:right"><input type="text" class="field" id="eRS_same_all"><button id="changeAll">Change for All</button></div>'),X.get("/"+G+"/economy/job-market/"+Z,function(t){X("#eRS_same_all").val(parseFloat(X("strong,sup",X(".jm_salary:eq(1)",t.replace(/src=/g,"tmpsrc="))).text())),1==X(".active_offers:not(.daily_budget) .job_salary").text().length&&X("#job_salary_value").val(X("#eRS_same_all").val()),X("#changeAll").click(function(){X("input[id^=salary_value_]").val(X("#eRS_same_all").val()),X("a[id^=save_salary_]").each(function(t){setTimeout(executeAction,3e3*t,X(this),"update_salary")})})}),X(".bottom_details").css("cssText","position:sticky;bottom:0"),X(".list_group").css("box-shadow","none"),X("#edit_mode").after('<a id="SortButton" class="std_global_btn smallSize blueColor employees" title="Sort by salary"><span></span></a><a href="/'+G+"/economy/job-market/"+Z+'" class="std_global_btn smallSize blueColor employees" title="Go to job market"><span>M</span></a>'),X("#SortButton").click(function(){var t=X(".current_salary").map(function(){return{wage:X(this).text().split(" ")[0],row:X(this).parent().parent()}}).get()
"↑"!=X("#SortButton span").text()?(X("#SortButton span").text("↑"),t.sort(function(t,e){return e.wage-t.wage})):(X("#SortButton span").text("↓"),t.reverse())
for(var e=0;e<t.length;e++)X(".list_group").append(t[e].row)}).click()}function p(){X(".eRS_CostperUse,#eRS_otherMarket").remove()
var e=angular.element(X("#marketplace")).scope().settings,i=[e.countryId,e.industryId,e.lastQuality],a=i[0]==Z?erepublik.citizen.countryLocationId:Z
X("#eRS_erepDE").length?X("#eRS_erepDE")[0].href=ot+"en/tools/marketplace/0/"+m(i[1])+"/"+i[2]:(t("#eRS_otherMarket{background:#83B70B;color:#FFF;padding:0 4px;border-radius:2px;float:right;cursor:pointer}#eRS_otherMarket:hover{background:#FB7E3D}#eRS_otherMarket span{background:#FB7E3D;float:right;margin:0 -4px 0 4px;padding:0 4px;border-radius:2px}#eRS_erepDE{height:30px;float:right;margin:0 70px -10px 10px}#eRS_erepDE img{height:30px}#eRS_erepDE img:hover{transform:scale(1.2,1.2);transition:transform 0.5s}.eRS_CostperUse{width:110px;text-align:center;font-size:14px}.item_quantity_wrapper{width:125px;padding:1px;border:1px solid transparent}"),X("#marketplace h1:eq(0)").append('<a id="eRS_erepDE" href="'+ot+"en/tools/marketplace/0/"+m(i[1])+"/"+i[2]+'" title="Find the best offers globally"><img src="'+ot+'assets/img/logo1-default_small.png"></a>'),X("#eRS_erepDE").tipsy()),(erepublik.citizen.countryLocationId!=Z||i[0]!=Z)&&h(a,function(){var t=((nt[a][m(i[1])]["q"+i[2]]||[])[0]||{}).gross
X("#marketplace h1:eq(0)").append('<a id="eRS_otherMarket">'+erepublik.info.countries[a].name+"<span>"+(t?t.toFixed(2)+tt:"No offers")+"</span></a>"),X("#eRS_otherMarket").click(function(){X("#countryId").val(a).change()})}),i[1]<2&&(X("#marketplace thead .m_stock").after('<th class="eRS_CostperUse">'+tt+" / HP</th>"),X("#marketplace .price_sorted tr").each(function(){X(".m_stock",this).after('<td class="stprice eRS_CostperUse">'+(parseFloat(X(".m_price",this).text())/industryJSON[i[1]].attributes[i[2]].effect).toFixed(4)+"</td>")}))}function c(){X(".m_buy a").each(function(){X(this).data("max",X(this).attr("data-max")).data("price",X(this).attr("data-price"))}),X(".quantity_button.maximum").click()}function d(){X("#back_to_battle").click(function(){K.stats[0]++,K.stats[2]+=+X(".award_damage strong").text(),H()})}function g(){function t(){X("button[data-currency=GOLD]").each(function(){erepublik.exchange.displayPrice(X(this).parent().find("input").val(Math.min(X(this).attr("data-max"),10,Math.floor(100*X("#eCash").val()/X(this).attr("data-price"))/100)))}).css("max-width","unset"),X(".ex_citizen").css("width","190px"),X(".ex_amount").css("padding-right","30px")}ajaxSuccess.push(t),t()}function u(){function i(){X('tr[id^="offer_"]:visible').each(function(){X(".std_global_btn.smallSize.blueColor,.Net_unit,.Total_net,.share_offer",this).remove()
var t=this,i=X.map(erepublik.info.countries,function(e,i){return e.permalink==X(".offer_flag",t).attr("src").split("/M/")[1].split(".")[0]?i:null})[0],a=X(".offer_image",this).attr("src").split("/industry/")[1].split("/"),n=/q/.test(a[1].split("_")[0])?a[1].split("_")[0].replace("q",""):1,o=countryList[i].taxes[a[0]],r=X(".offer_price strong",this).text().replace(/,/g,"")/((100+(+o.value_added_tax+(i!=Z?+o.import_tax:0)))/100),s=r*X(".offer_amount",this).text().replace(/,/g,"")
X(".offer_price",this).after('<td class="Net_unit"><strong>'+r.toFixed(4)+"</strong> "+tt+'</td><td class="Total_net"><strong>'+e(s.toFixed(2))+"</strong> "+tt+"<br><span>"+e((s/K.goldPrice.price).toFixed(2))+"</span><span> g</span></td>"),X(".delete_offer",this).before('<a title="Visit market" class="std_global_btn smallSize blueColor" href="/'+G+"/economy/marketplace#"+i+"/"+a[0]+"/"+n+'"><span>M</span></a><a class="std_global_btn smallSize blueColor" href="https://www.erepublik.com/en/economy/marketplace/offer/'+this.id.split("_")[1]+'" title="Share offer"><span>O</span></a>')})}t("td:last-child,#Net_unit,.Net_unit,#Total_net,.Total_net,#Total_netF{padding-left:0!important}.Total_net,#Total_netF{padding:15px;text-align:right}.Total_net span,#Total_netF span{font-size:11px}.delete_offer{opacity:1!important}td .std_global_btn.smallSize.blueColor{float:left;margin:-8px 0px 0px 12px;padding:0px 15px}tfoot tr{background:#F7FCFF;height:44px}")
var a=X(".area.storage h4:first strong").text().replace(/[,()]/g,"").split("/")
X(".area.storage h4:first strong").append(" Free space: "+e(a[1]-a[0])),X("th input").css("width","50px"),X(".offers_product").css("width","70px").next().css("width","80px").next().css("width","120px").next().css("width","60px").next().css("width","132px").find("a").css("cssText","left:10px;margin-right:20px;padding:0 10px"),X("#sell_offers table").append('<tfoot><tr><td colspan="4"><td id="Total_netF"></td><td colspan="2"></td></tr></tfoot>'),K.goldPrice=K.goldPrice||{},K.goldPrice.date!=it&&X.post("/"+G+"/economy/exchange/retrieve/",{_token:SERVER_DATA.csrfToken,page:1,currencyId:62},function(t){K.goldPrice.price=t.split("data-price='")[1].split("'")[0],K.goldPrice.date=it,H()}),setInterval(function(){var t=0
X(".Total_net:visible").each(function(){t+=+X("strong:eq(0)",this).text().replace(/,/g,"")}),X("#Total_netF").html("<strong>"+e(t.toFixed(2))+"</strong> "+tt+"<br><span>"+e((t/K.goldPrice.price).toFixed(2))+"</span><span> g</span>"),X("#Net_unit,#Total_net").remove()
var i=X("#market_select").attr("country"),a=countryList[i].taxes[X("#sell_product").attr("src").split("/industry/")[1].split("/")[0]],n=(+X("#sell_price").val()||0)/((100+(+a.value_added_tax+(i!=Z?+a.import_tax:0)))/100),o=n*(+X("#sell_amount").val()||0)
X(".offers_price").after('<th id="Net_unit"><strong>Net/unit</strong><b>'+n.toFixed(4)+" "+tt+'</b></th><th id="Total_net"><strong>Total Net Value</strong><b>'+e(o.toFixed(2))+" "+tt+"</b><b>"+e((o/K.goldPrice.price).toFixed(2))+" g</b></th>")},100),X(".sell_selector .industry_quality_selector").click(function(){var t=Math.max(X(this).attr("quality"),1),e=X(this).attr("industry"),i=X("#market_select").attr("country")
X("#sell_amount").val(Math.min(itemAmounts[e][t]-(itemPartials[e]?!!itemPartials[e][t]:0),99999))
var a=X("img",this).attr("src").split("/industry/")[1],n=0
X('tr[id^="offer_"]:visible .offer_image').each(function(){X(this).attr("src").split("/industry/")[1]==a&&(n=X(this).parent().parent().find(".offer_price strong").text().replace(/,/g,""),setTimeout(function(){X("#sell_price").val(n)},0))}),n||(setTimeout(function(){X("#sell_price").val(0)},0),h(i,function(){X("#sell_price").val(((nt[i][m(e)]["q"+t]||[])[0]||{}).gross||minPrices[i][e][t])}))}),i(),ajaxSuccess.push(function(t,e){i(),/postMarketOffer/.test(e)&&X("#sell_amount").val(Math.min(itemAmounts[t.token.industryId][t.token.customization],99999))})}function h(t,e){nt[t]?setTimeout(e):X.getJSON("/"+G+"/economy/marketpicture/"+t,function(i){nt[t]=i,e()})}function m(t){return 1==t?"food":2==t?"weapons":3==t?"tickets":4==t?"houses":7==t?"frm":12==t?"wrm":"hrm"}function f(){t("#eRS_settings{margin:5px 0 -5px;width:100%;display:inline-block;cursor:pointer;background:#83B70B;color:white;font:bold 11px Arial;text-align:center;padding:3px 0px;border-radius:1px}#eRS_settings:hover,#eRS_options a:hover{background:#FB7E3D}#eRS_settings span{float:right;background:#FB7E3D;margin:-3px 0;padding:3px 7px}#eRS_options a{cursor:pointer;color:white;font-weight:bold;background:#83B70B;padding:5px;margin:20px;border-radius:1px}")
for(var e=[["Battlefield",[["Improve battlefield","battlefield"],["Enable AutoBot","autoBot"],["Automatically close wrong side warning","wrongSideNotice"]]],["Companies",[["Company manager","companyManager"],["Employee manager","employeeManager"],["Add employees link to My places","addEmployeesLink"]]],["Energy",[["Automatic energy recovery","energyRecovery"],["Stop recovery to maximize level-up refill","lvlUpNoRecovery"],["Show remaining time to full energy bar","fullEnergy"],["Show maximum energy to recover","maxEnergy"]]],["Main page",[["Improve feeds","improvedFeeds"],["Add international and latest articles","morePress"]]],["Marketplace",[["Improve marketplace","improveMarketplace"],["Autofill maximum product amount","autofillMarket"],["Add direct market links to main menu","marketLinks"]]],["Monetary market",[["Autofill maximum gold amount","autofillGold"]]],["Profile",[["Improve profile page","improveProfile"],["Influence calculator","influenceCalculator"],["Remove dead friends tool","deadFriends"]]],["Storage",[["Improve inventory","improveInventory"],["Display storage everywhere","displayStorage"]]],["Wars page",[["Show dom. points and wall percentages","getPoints"],["Add direct links for each side in RWs","directRWLinks"],["Single row layout","singleRowWars"],["Display allies in MPP battles","showMPPs"],["Battle filter","battleFilter"]]],["Other",[["Autorefresh main page every 10 minutes","autoRefresh"],["Display XP needed to level-up","xpLeft"],["Kills, hits, and damage on sidebar","showStats"],["Hide notifications","removeNotifications"],["Epic battle sensor","epicSensor"],["Ignore epic dictatorship battles","ignoreDictatorship"],["Top5 lists by damage instead of kills","damageRankings"],["Show active damage boosters everywhere","damageBoosterTimer"],["Show Merc, FF, and TP progress","mercFF"],["Remove external link warning","externalLinks"],["Autocorrect link protocol and language","linkFix"]]]],i="",a=0;a<e.length;a++){a&&6!=a||(i+='<div style="width:48%;margin:0.5%;float:left;background:#242B27">'),i+='<span style="background:#FB7E3D;color:white;padding:2px;font-weight:bold;display:inline-block;width:98.7%;text-align:center">'+e[a][0]+"</span>"
for(var n=0;n<e[a][1].length;n++)i+='<span style="color:white;padding:2px 5px;display:inline-block;width:100%;font-size:13px">'+e[a][1][n][0]+'<input type="checkbox" style="float:right;margin:2px 10px" id="'+e[a][1][n][1]+'"></span>';(5==a||9==a)&&(i+="</div>")}X("body").append('<div id="eRS_block" style="display:none;z-index:999998;position:fixed;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6)"></div><div id="eRS_options" style="display:none;width:600px;margin:auto;cursor:default;position:fixed;left:'+(X(window).width()-600)/2+'px;z-index:999999"><div style="position:absolute;top:-20px;width:100%;text-align:center"><a href="https://docs.google.com/spreadsheets/d/1nal62cgC7lUmrur6NRzlPVU3uxtE59WGV9-bZcPoIw8/edit">Script Homepage</a><a id="reset" title="Deletes all stored data (settings, stats, caches). If you use other eRepublik scripts utilizing localStorage, their data will be deleted, too.">RESET</a><a href="https://googledrive.com/host/0B3iVfXry1NkpbHRqUmdWTVhtXzQ/eRepublik_Stuff++.user.js">UPDATE</a><a href="/'+G+'/citizen/profile/6365664">Contact / Donate</a><a>Close</a></div>'+i+"</div>"),setTimeout(K.x),X("#eRS_options").css("top",(X(window).height()-X("#eRS_options").height())/2+"px").find("input").each(function(){X(this).prop("checked",!K[X(this).attr("id")])}).change(function(){K[X(this).attr("id")]=!X(this).prop("checked"),H()}),X("#eRS_options a:last,#eRS_block").click(function(){X("#eRS_options,#eRS_block").hide()}),X(".user_finances").after('<div id="eRS_settings" title="Click to open settings">eRepublik Stuff++<span>'+GM_info.script.version+"</span></div>"),X("#eRS_settings").tipsy({gravity:"e"}).click(function(){X("#eRS_options,#eRS_block").show()}),X("#reset").click(function(){localStorage.clear(),location.reload()})}function _(){K.stats=[0,0,0],H(),K.showStats||i()}function x(){function t(){X('a[href*="/main/warn/"]').each(function(){var t=X(this).text().replace(/[;:.,]+$/,""),e=/https?:\/\/[a-zA-Z0-9][.]+$/,i=X(this)[0].previousSibling||{},a=X(this)[0].nextSibling||{}
if((4==location.href.split("/").length||/www\.|https?:\/\//.test(t))&&X(this).attr("href",/https?:\/\//.test(t)?t:"http://"+t).after(/[;:.,]+$/.exec(X(this).text())).text(t),e.test(i.nodeValue||"")){var n=e.exec(i.nodeValue)
X(this).text(n+X(this).text()).attr("href",X(this).text()),i.nodeValue=i.nodeValue.split(n)[0]}if("'"==(a.nodeValue||"")[0]){var o=a.nodeValue.split(" ")[0]
X(this).text(X(this).text()+o).attr("href",X(this).text()),a.nodeValue=a.nodeValue.split(o)[1]}/main\/warn/.test(X(this).attr("href"))&&X.get(X(this).attr("href"),X.proxy(function(t){X(this).attr("href",t.split('class="content"')[1].split('href="')[1].split('"')[0])},this))})}ajaxSuccess.push(function(e,i){/main\/warn|\/eat|\/inventory|\/campaigns/.test(i)||t()}),t()}function v(){X("#xpleft").remove()
var t=X("#experienceTooltip strong:eq(2)").text()-X("#experienceTooltip strong:eq(1)").text()
X(".user_level").append('<div id="xpleft" style="float:right;position:relative;font-size:10px;color:#777;'+(Q?'top:-3px;left:23px"><span style="':'top:14px">XP left: <span style="padding:1px')+";background:"+(reset_health_to_recover<=10*t?"#6ebce5":"red")+';color:white;font-weight:bold;border-radius:2px">'+t+"</span></div>"),setTimeout(v,200)}function b(){t("#CompanyManager{float:right}#CompanyManager strong{position:relative;bottom:8px;right:5px;font-size:12px}#CompanyManager span{cursor:pointer;border-radius:3px}#CompanyManager span:hover{opacity:0.5}#CompanyManager img{height:30px}")
for(var e=[0,0,0],i=1;15>=i;i++)e[5>=i?0:10>=i?1:2]+=pageDetails.resources[i].bonus
X(".area h4 a").remove(),X(".area h4").append('<span style="float:left;margin:23px 1px -100%;color:#656565;font:90% bold">Food: <b>+'+e[0]+"%</b> Weapon: <b>+"+e[1]+"%</b> House: <b>+"+e[2]+'%</b></span><div id="CompanyManager"><strong>Work as Manager</strong></div>'),X(".area h4 b").each(function(){X(this).css("color",100==parseInt(X(this).text())?"#83B70B":parseInt(X(this).text())>0?"#FB7E3D":"#D74A4A")}),X(".listing.companies:not(.disabled) .area_pic > img").each(function(){X('#CompanyManager img[src="'+X(this).attr("src")+'"]').length||X("#CompanyManager").append('<span><img src="'+X(this).attr("src")+'" title="'+X('.listing.companies .area_pic > img[src="'+X(this).attr("src")+'"]:eq(0)').attr("title")+'"></span>')}),X("#CompanyManager span").click(function(){X(".listing.companies:not(.disabled) .area_pic > img").parent().parent().find(".owner_work").removeClass("active"),window.pageDetails.recoverable_health.value=food_remaining,X('.listing.companies:not(.disabled) .area_pic > img[src="'+X("img",this).attr("src")+'"]:lt('+Math.floor((globalNS.userInfo.wellness+Math.min(pageDetails.recoverable_health.value,pageDetails.recoverable_health_in_food))/10)+")").parent().parent().find(".owner_work:not(.active)").addClass("active"),X(".listing.companies:not(.disabled)").each(function(t,e){applyCheck(e),warnForCritical()})})}function y(){t("#boosters_timers{bottom:90px!important;left:5px}#special_items_list,.deploy_bomb{display:block!important}#switch_side,#dmg_sum{position:absolute;background:#83B70B;color:#FFF;padding:3px;font:bold 11px Arial}#switch_side{right:37px}#switch_side:hover{background:#FB7E3D;cursor:pointer}#dmg_sum{display:none;left:600px;top:0}#pvp .campaign_details .entry em{opacity:1}#pvp .campaign_details .entry .pdomi_left em{right:5px}#eRSTravel{display:none;position:absolute;top:0;right:115px;background:#4B4B49;border:1px solid #333;color:#FFF;font:11px Arial;padding:1px 4px}#round_number{position:absolute;color:white;text-align:center;width:100%;font:13px ds-digitalbold_italic;top:26px}.top5_list{visibility:visible;position:absolute;top:-6px;padding:2px 0;border-radius:2px;background:rgba(0,0,0,0.6);color:white;cursor:default;z-index:31;font:bold 9px Arial,sans-serif}.top5_list a{color:#83B70B;margin:0 3px}.top5_list span{float:right;margin:0 3px}#right_top5{right:0}#campaign_top5{top:60px}#personal_stats{cursor:default;text-align:center;position:absolute;top:7px;width:100%;color:#FFE49B;font:bold 11px Arial,sans-serif}.eRS_hasBudget span{color:#FFE49B}"),X("#drop_part,#special_weapons_go,.battle_heroes,.extraDamageDiv > b").remove(),X("#extraDamageDiv").css("bottom","3px"),X(".weapon_link").removeAttr("target"),X("#special_items_list").append(X(".addon").children()),X(".deploy_bomb").hide(),X.cookie("collection_full",1,{expires:999,path:"/"}),clearInterval(globalSleepInterval),k(),X(".status_bar").append('<div id="dmg_sum"></div>'+(X(".country_avatar.dictatorship").length?"":'<a id="switch_side">SWITCH SIDE</a>'))
var e=regionsInvolved[rightBattleId]
X("#pvp").append('<select id="eRSTravel"><option>Select region</option></select><div id="round_number">Round '+SERVER_DATA.zoneId+"</div>")
for(var i in e)e.hasOwnProperty(i)&&X("#eRSTravel").append('<option value="'+e[i].id+'">'+e[i].name+(e[i].current_owner_country_id!=e[i].original_owner_country_id?"*":"")+"</option>")
X("#switch_side").click(function(){SERVER_DATA.isResistance?location.href="/"+G+"/military/battlefield-choose-side/"+SERVER_DATA.battleId+"/"+rightBattleId:X("#eRSTravel").toggle()}),X("#eRSTravel").change(function(){"Select region"!=X("option:selected",this).text()&&(confirm("Are you sure you want to change location?")?X.post("/"+G+"/main/travel/",{battleId:SERVER_DATA.battleId,_token:SERVER_DATA.csrfToken,toCountryId:rightBattleId,inRegionId:X("option:selected",this).attr("value")},function(t){location.reload()}):X("#eRSTravel").hide())}),X(".dropdown_filter").after('<div class="data_filters_div dropdown_filter"><label>Top5 list settings</label><br><select id="eRS_killsdamage"><option value="damage">Damage</option><option value="kills">Kills</option></select></div><div class="data_filters_div dropdown_filter"><select id="eRS_division"><option value="1">Division 1</option><option value="2">Division 2</option><option value="3">Division 3</option><option value="4">Division 4</option></select></div>'),X("#eRS_killsdamage").val(at).change(function(){at=X(this).val(),K.damageRankings="kills"==at,H(),k()}),X("#eRS_division").val(et).change(k),X(".plain").attr("href","#").click(function(){X(this).parents(".change_residence").remove()})}function k(t){if("undefined"==typeof right_percent)return setTimeout(k,100)
X(".activated").text()&&X(".activated").css("cssText","display:"+(X(".condition").length?"block;":"none;")+((SERVER_DATA.mustInvert?100-current_domination:current_domination)<Math.max.apply(null,X("strong[data-bind=mu_treshold]").map(function(){return parseInt(X(this).text())}).get())?"filter:hue-rotate(110deg);-webkit-filter:hue-rotate(110deg)":"filter:none;-webkit-filter:none")),X(".top5_list").remove(),X("#battleConsole").append('<div id="left_top5" class="top5_list"></div><div id="right_top5" class="top5_list"></div><div id="campaign_top5" class="top5_list"></div>')
for(var i=(currentStats[SERVER_DATA.zoneId]||{})[X("#eRS_division").val()]||{},a=(i[leftBattleId]||{})["top_"+at]||[],n=(i[rightBattleId]||{})["top_"+at]||[],o=((overallStats[0]||{})[leftBattleId]||{})["top_"+at]||[],r='<a href="/'+G+"/citizen/profile/",s=0;s<a.length;s++)X("#left_top5").append(r+a[s].citizen_id+'">'+fightersData[a[s].citizen_id].name+"</a><span>"+e(a[s][at])+"</span><br>")
for(var l=0;l<n.length;l++)X("#right_top5").append(r+n[l].citizen_id+'">'+fightersData[n[l].citizen_id].name+"</a><span>"+e(n[l][at])+"</span><br>")
for(var p=0;p<o.length;p++)X("#campaign_top5").append(r+o[p].citizen_id+'">'+fightersData[o[p].citizen_id].name+"</a><span>"+e(o[p][at])+"</span><br>")
for(var c=t||aoeBattleData.campaigns,d=0;d<c.length;d++)X("#label"+c[d].id+" .condition").prev().html(c[d].reward+tt+"/mil <span>Σ"+e(c[d].budget)+tt+"</span>").addClass("eRS_hasBudget")
var g=currentEpicZoneSituation[X("#eRS_division").val()]
g&&q(g,SERVER_DATA.battleId),X("#dmg_sum").text((2==g?"Epic":1==g?"Full":"Cold")+" "+w(S(i[leftBattleId]||{})+S(i[rightBattleId]||{}),1)).show(),X(".notifier").is(":visible")&&X(".close_console").show().css("z-index",1)
var u=(((personalStats[SERVER_DATA.zoneId]||{})[leftBattleId]||[]).top_damage||[])[0]||{}
return X("#personal_stats").length?void 0:0===+X("#total_damage strong").text()||u.damage?void X("#total_damage").after('<div id="personal_stats"><q>'+e(u.kills||0)+"</q> | <q>"+e(u.hits||0)+"</q> | <q>"+e(u.damage||0)+"</q></div>").hide():setTimeout(battleStats.getBattleStats,500)}function w(t,e){return t>1e9?(t/1e9).toFixed(e+1)+"B":(t/1e6).toFixed(e)+"M"}function S(t){function e(){var t=i[i.length-1]-s/1.5
t>0&&(i.push(t),e())}for(var i=[],a=t.top_damage||[],n=t.top_kills||[],o=0;o<a.length;o++)i.push(+a[o].damage)
for(var r=0;r<n.length;r++)i.indexOf(+n[r].damage)<0&&i.push(+n[r].damage)
i.sort(function(t,e){return e-t})
var s=(i[0]-i[i.length-1])/(i.length-1)
return 5==a.length&&e(),i.length?i.reduce(function(t,e){return t+e}):0}function R(){ajaxSuccess.push(function(t,a){if(!/military\/fight-shooot|military\/deploy-bomb/.test(a)||t.error||"ENEMY_KILLED"!=t.message&&"OK"!=t.message)/military\/nbp-stats/.test(a)&&!K.battlefield?setTimeout(k,0,t.campaigns):/fight-activateBooster/.test(a)&&"damage"==t.type&&(K.damageBooster=t.activeBooster.remaining+Date.now()/1e3,H())
else{var n=0;/military\/deploy-bomb/.test(a)?n=t.bomb.damage:(n=t.user.givenDamage,K.stats[1]+=t.user.earnedXp,X("#personal_stats q:eq(1)").text(e(+X("#personal_stats q:eq(1)").text().replace(/,/g,"")+t.hits)),t.oldEnemy.isNatural&&(n+=Math.floor(.1*n))),K.stats[0]++,K.stats[2]+=n,X("#personal_stats q:eq(0)").text(e(+X("#personal_stats q:eq(0)").text().replace(/,/g,"")+1)),X("#personal_stats q:eq(2)").text(e(+X("#personal_stats q:eq(2)").text().replace(/,/g,"")+n)),H(),K.showStats||i(),$.current+=n,$.done+=n,$.current>=$.next&&($.next+=1e8,$.done=Math.max($.done-1e8,0)),X("#mercenary q").text(Math.min(+X("#mercenary q").text()+1,25)),X("#freedom_fighter q:eq(0)").text(Math.min(+X("#freedom_fighter q:eq(0)").text()+1,75)),X("#true_patriot q").text(($.done/($.next-$.current+$.done)*100).toFixed(2))}})}function F(){function i(t){"AUTOBOT OFF"==X("#AutoBotSwitch").text()||t!=n||X("#kills").val()<=0&&!X("#allin").is(":checked")||(setTimeout(i,3e3,++n),X.post("/"+G+"/military/fight-shooot/"+SERVER_DATA.battleId,{sideId:SERVER_DATA.countryId,battleId:SERVER_DATA.battleId,_token:SERVER_DATA.csrfToken},function(t){return("UNKNOWN_SIDE"==t.message||"WRONG_SIDE"==t.message)&&(location.href=t.url),"SHOOT_LOCKOUT"==t.message?setTimeout(i,100,n):"ENEMY_ATTACKED"==t.message||"LOW_HEALTH"==t.message?a(0):(X("#allin").is(":checked")||X("#kills").val(X("#kills").val()-1),X("#rank_min").text(e(t.rank.points)+" Rank Points"),X("#rank_status_gained").css("width",t.rank.percentage+"%"),window.totalPrestigePoints+=t.hits,X("#prestige_value").text(e(window.totalPrestigePoints)),X("#side_bar_currency_account_value").text(e(t.details.currency)),X(".left_player .energy_progress").css("width",t.details.current_energy_ratio+"%"),X(".right_player .player_name").text(t.enemy.name),X(".right_player .energy_progress").css("width",t.enemy.energyRatio+"%"),X(".weapon_no").text(t.user.weaponQuantity),globalNS.updateSideBar(t.details),void a(t.details.wellness))}))}function a(t){setTimeout(function(){return!X("#eatEB").is(":checked")&&!food_remaining&&10>t||X("#kills").val()<=0&&!X("#allin").is(":checked")?X("#AutoBotSwitch").click():!K.lvlUpNoRecovery&&t+food_remaining>=10*(X("#experienceTooltip strong").eq(2).text()-X("#experienceTooltip strong").eq(1).text())||!X("#eatEB").is(":checked")&&!food_remaining||t>=(X("#allin").is(":checked")?90:10)?i(n):(setTimeout(i,3e3,n),void X.getJSON("/"+G+"/main/eat?format=json&_token="+SERVER_DATA.csrfToken+"&buttonColor="+(X("#eatEB").is(":checked")?"orange":"blue"),function(t){setTimeout(i,100,n),energy.processResponse(t)}))},parseInt(Y%558?"44C":"28A",16))}t("#AutoBot{background:#242B27;position:absolute;top:320px;border-radius:3px;color:white;font-size:12px;font-weight:bold;line-height:20px;text-align:center;z-index:31}#AutoBot input{margin:3px}#AutoBotSwitch{cursor:pointer;width:100%;background:#FB7E3D}#AutoBotSwitch:hover{background:#83B70B!important}"),X(".battle_footer").after('<div id="AutoBot"><div style="padding:5px">Kills:<input id="kills" type="text" size="1" value="25" style="text-align:center"><label><input id="allin" type="checkbox">All-in</label></br><label><input id="eatEB" type="checkbox">Eat energy bars</label></div><div id="AutoBotSwitch">AUTOBOT OFF</div></div>')
var n=0
X("#AutoBotSwitch").click(function(){"AUTOBOT OFF"==X(this).text()?(X("#AutoBotSwitch").text("AUTOBOT ON").css("background","#83B70B"),pomelo.disconnect(),i(n)):(X("#AutoBotSwitch").text("AUTOBOT OFF").css("background","#FB7E3D"),connectBattleSocket())}),X("#allin").change(function(){X("#kills").prop("disabled",X(this).is(":checked"))})}function T(){X(".country_avatar.dictatorship").length||X.get("/"+G+"/citizen/profile/"+Y,function(e){t("#mercenary,#freedom_fighter,#true_patriot{color:#FFF;padding:3px;font:bold 11px Arial;position:absolute;top:0;width:40px}#mercFFdiv{position:absolute;bottom:46px;right:5px}#mercFFdiv span{cursor:default;border-radius:1px;padding:3px;color:#4C4C4C;background:"+X("li.ng-scope:visible:eq(0)").css("border-top-color")+";font:bold 11px arial;margin:3px}#mercenary{left:181px;background:#FB7E3D}#freedom_fighter{left:227px;background:#83B70B}#true_patriot{left:"+(X(".resistance_badge").length?273:227)+"px;background:#009CFF}.countyTime > div{text-align:center;position:absolute;width:90px;right:0px;top:17px}.countyTime div div{display:inline;padding:1px 3px 0;margin:0 2px}")
var i=e.replace(/src=/g,"tmpsrc="),a=X("#achievment > li:eq(10) .country_list li",i),n=(X('#freedom_fighter_region_list li:not(.completed)[title*=", '+X("#region_name_link").text()+'"] em',i).text()||"0/"+25*(X("#achievment .counter:eq(0)",i).text()%3+1)).split("/"),o=X(".citizen_military:eq(0)",i),r=+X(".mids",o).css("width").split("%")[0]||.001,s=X("strong:last",o).text().replace(/,/g,"").split("/")
$.current=+s[0],$.next=+s[1],$.done=($.next-$.current)/(100-r)*r
var l=X("#achievment > li:eq(10) span big strong",i).text(),p=25*(X("#achievment .counter:eq(0)",i).text()%3+1),c=X("#achievment > li:eq(0) span big:eq(0) strong",i).text(),d=[' title="Mercenary kills"',' title="Freedom Fighter kills"',' title="True Patriot medal progress"']
X(".status_bar").length&&X(".status_bar").append('<div id="mercenary"'+d[0]+"><q>"+X('img[tmpsrc$="/'+X(".country.left_side img").attr("src").split("/").pop()+'"] ~ em',a).text().split("/")[0]+"</q> - "+X('img[tmpsrc$="/'+X(".country.right_side img").attr("src").split("/").pop()+'"] ~ em',a).text().split("/")[0]+"</div>"+(X(".resistance_badge").length?'<div id="freedom_fighter"'+d[1]+"><q>"+Math.min(n[0],75)+"</q> / <q>"+n[1]+"</q></div>":"")+(Z==leftBattleId?'<div id="true_patriot"'+d[2]+"><q>"+r.toFixed(2)+"</q>%</div>":"")),X(".resistance_badge").length&&X("#kills").val(n[1]-n[0]>0?n[1]-n[0]:25),X("li.ng-scope").each(function(){var t=angular.element(X(this)).scope().campaign,e=+X('img[tmpsrc$="/'+(/Bosnia/.test(t.inv.permalink)?"Bosnia-Herzegovina":t.inv.permalink)+'.png"] ~ em',a).text().split("/")[0],n=+X('img[tmpsrc$="/'+(/Bosnia/.test(t.def.permalink)?"Bosnia-Herzegovina":t.def.permalink)+'.png"] ~ em',a).text().split("/")[0],o=X('#freedom_fighter_region_list li a[href$="'+X(".fight_button a",this).attr("href")+'"]',i),r=o.parent().parent().find("em").text().split("/")
t.is_dict||t.is_lib||X(".countyTime",this).append("<div>"+(o.length?"<div"+d[1]+"><span"+(+r[0]<+r[1]?' style="color:#FF6600"':"")+">"+Math.min(r[0],75)+"</span> / "+r[1]+"</div>":"")+"<div"+d[0]+'><span style="color:#'+(e?25>e?"FF6600":"":"DD0000")+'">'+e+'</span> - <span style="color:#'+(n?25>n?"FF6600":"":"DD0000")+'">'+n+"</span></div></div>").find("div div").css("background-color",X(".countyTime",this).css("background-color"))}).eq(0).append('<div id="mercFFdiv"><span title="'+(c.split("/")[1]-c.split("/")[0])*p+' kills needed">Freedom Fighter '+c+" (x"+p+')</span><span title="'+25*(50-l.split("/")[0])+' kills needed">Mercenary '+l+"</span><span>True Patriot "+r.toFixed(2)+"%</span></div>"),X("#mercFFdiv span,#mercenary,#freedom_fighter,#true_patriot,.countyTime div div").tipsy({gravity:"s"})
var g=K.battleFilter_lastView||"none"
X("#eRS_battleFilter a[value=merc]").click(),X("#eRS_battleFilter a[value="+g+"]").click()})}function E(){function i(){for(var t=X("#InfCalc_hits").val(),i=0;8>i;i++){var n=10*(1+X(".mb_bottom:eq(0)").text().replace(/,/g,"")/400)*(1+s/5)*(1+(7>i?20*i:200)/100)*(1+parseInt(X("#InfCalc_legend").val())/100)*X("#InfCalc_booster option:selected").val()
X("#InfCalc_NE").is(":checked")&&(n*=1.1),X(".citizen_level:eq(0)").text()>100&&(n*=1.1),X("#InfCalc_Q"+i+" span").html((t*n>999999?e((t*n/1e6).toFixed(2))+"M":e(Math.round(t*n)))+"<br>"+e(Math.ceil(10*(a[1]-a[0])/(n/(X("#InfCalc_NE").is(":checked")?1.1:1)*(X("#InfCalc_WarStash").is(":checked")?1.1:1))))+"<br>"+e(Math.ceil((l[1]-l[0])/n))+"<br>"+(0===i?"-":e((1e6*K.wepprice[i]/n).toFixed(2))))}}t("#eRS_InfCalc{font-size:11px;color:#666;padding-bottom:0;margin:-10px 0 5px;background:#F7FBF1;border:0}#eRS_InfCalc table{margin:5px}#eRS_InfCalc td{width:11%}#InfCalc_hits,#InfCalc_legend{padding:4px;text-align:center;width:35px;font-size:11px;margin:0 5px 0 5px}#eRS_InfCalc label{margin:0 5px}#eRS_InfCalc span{display:inline-block;text-align:right;width:100%}#eRS_InfCalc img{width:40px;height:40px;margin:0 0 0 20px}#InfCalc_NE,#InfCalc_WarStash,#InfCalc_booster{margin-left:5px;position:relative;top:2px;text-align:center}#InfCalc_booster{font-size:11px;padding:4px;top:0}")
var a=X(".rank_numbers").text().replace(/,/g,"").split("/"),n=X(".citizen_military_box_wide img").attr("src").split("/")[6].split(".")[0].split("_"),o=[+n.pop(),n.join("_")],r=["recruit","private","corporal","sergeant","lieutenant","captain","major","commander","lt_colonel","colonel","general","field_marshal","supreme_marshal","national_force","world_class_force","legendary_force","god_of_war","titan","legendary"].indexOf(o[1]),s=0===r?1:18>r?4*r-2+o[0]:70+Math.floor((a[0]-2e10)/1e10),l=X(".stat:eq(0) small:eq(1) strong").length?X(".stat:eq(0) small:eq(1) strong").text().replace(/,/g,"").split("/"):[0,X(".stat:eq(1) small:eq(1) strong").text().replace(/,/g,"").split("/")[1]]
K.wepprice=K.wepprice||{},K.wepprice[7]&&K.wepprice.date==it||h(35,function(){for(var t=1;8>t;t++)K.wepprice[t]=nt[35][m(2)]["q"+t][0].gross/(7>t?t:10)
K.wepprice.date=it,H(),i()}),X(".citizen_military_box_wide").after('<div id="eRS_InfCalc" class="citizen_military"><label>Hits <input type="text" id="InfCalc_hits" value="1"></label><label>Natural Enemy <input type="checkbox" id="InfCalc_NE"></label><label title="+10% rank points">War Stash <input type="checkbox" id="InfCalc_WarStash"></label><label>Damage Booster<select id="InfCalc_booster"><option value="1.0">None</option><option value="1.5">50%</option><option value="2.0">100%</option></select></label><label title="Legendary bonus in TP battles. Note: some players are legends in multiple/other countries and their actual bonus may be lower or null.">Legend Bonus<input type="text" id="InfCalc_legend" value="'+10*Math.max(s-69,0)+'%"></label><table><tr><td><span style="text-align:left;margin:44px 0 0"><b>Influence:<br>Rank up:<br>Next TP:<br>Cost cc/M:</b></span></td></tr></table></div>')
for(var p=0;8>p;p++)X("#eRS_InfCalc tr").append('<td id="InfCalc_Q'+p+'"><img'+B("icons/industry/2/q"+(0===p?1:p)+".png")+(0===p?' style="opacity:0.5"':"")+"><span></span></td>")
i(),X("#InfCalc_hits,#InfCalc_legend").keyup(i),X("#InfCalc_NE,#InfCalc_WarStash,#InfCalc_booster").change(i)}function B(t){if(K.imgCache=K.imgCache||{},t in K.imgCache&&K.imgCache[t].length>100)return' src="'+K.imgCache[t]+'"'
var e=Date.now()+""+(1e10*Math.random()).toFixed(0)
X("body").append('<img id="eRS_cache'+e+'" style="display:none" src="/images/'+t+'">')
var i=document.getElementById("eRS_cache"+e),a=document.createElement("canvas"),n=a.getContext("2d")
return a.width=i.width,a.height=i.height,n.drawImage(i,0,0,i.width,i.height),K.imgCache[t]=a.toDataURL(),H(),' src="/images/'+t+'"'}function C(){function i(t){var i=angular.element(t).scope().campaign,a=i.is_dict||i.is_lib?255:i.inv.id,n=i.def.id
"Loading data..."==X(".war_versus_img",t).attr("original-title")&&X.getJSON("/"+G+"/military/battle-stats/"+i.id,function(o){if(o.error)X(".war_versus_img",t).attr("title","Server limit reached. Try again in 10 minutes.")
else{var r=Object.getOwnPropertyNames(o.stats.current),s=o.stats.current[r],l="domination",p="top_"+at,c=o.division,d="",g=""
if(s[et]){if(s[et][a])for(var u=0;u<s[et][a][p].length;u++)d+=o.fightersData[s[et][a][p][u].citizen_id].name+" <span>"+e(s[et][a][p][u][at])+"</span><br>"
if(s[et][n])for(var h=0;h<s[et][n][p].length;h++)g+=o.fightersData[s[et][n][p][h].citizen_id].name+" <span>"+e(s[et][n][p][h][at])+"</span><br>"}X(".war_versus_img",t).attr("original-title",function(){for(var t="<table><tr><td>Points</td><td>Dom</td><td>Wall</td><td>Round "+r+"</td><td>Wall</td><td>Dom</td><td>Points</td></tr>",e=1;5>e;e++)t+="<tr "+(e==et?'style="background:#83B70B"':"")+"><td>"+c[a][e].points+"</td><td>"+c[a][e][l]+"</td><td>"+(100-c[l][e]).toFixed(2)+'%</td><td class="middleCell">'+(2===o.battle_zone_situation[e]?"Epic":1===o.battle_zone_situation[e]?"Full":"Cold")+"<span> "+w(S((s[e]||{})[a]||{})+S((s[e]||{})[n]||{}),0)+"</span></td><td>"+c[l][e].toFixed(2)+"%</td><td>"+c[n][e][l]+"</td><td>"+c[n][e].points+"</td></tr>"
return t+'<tr><td colspan="3">'+d+'</td><td></td><td colspan="3">'+g+"</td></tr></table>"}),X(".combat_orders_revamp",t).each(function(){for(var e=X(this).hasClass("right_side"),o=i.div[et].co[e?"def":"inv"],r=0;r<o.length;r++)if(o[r].canShowCo&&(e?c[l][et]:100-c[l][et])<o[r].threshold&&c[e?n:a][et][l]<1800&&/:/.test(X(".countyTime",t).text())){X(this).css("background-color","#007400"),X(".arrow",this).attr("style","filter:hue-rotate(110deg);-webkit-filter:hue-rotate(110deg)")
break}})}X(".war_versus_img",t).is(":hover")&&X(".war_versus_img",t).tipsy("show")})}t(".tipsy-inner{max-width:999px!important}.tipsy-inner tr:last-child td{text-align:left;vertical-align:text-top}.tipsy-inner tr:last-child span{float:right;margin:0 0 0 5px}.tipsy-inner td{min-width:30px}.middleCell{text-align:left;padding:0 0 0 2px}.middleCell span{float:right;padding:0 2px}"),X(".war_versus_img").attr("original-title","Loading data...").tipsy({gravity:"s",html:!0,opacity:1}),X("li.ng-scope").each(function(){X(".combat_orders_revamp",this).length?i(X(this)):X(".war_versus_img",this).mouseover(function(){i(X(this).parent())})})}function I(){t(".RWQuickLink span:hover{transform:scale(1.2,1.2);transition:transform 0.5s}"),X("li.ng-scope").each(function(){var t=angular.element(X(this)).scope().campaign
t.is_rw&&X(".country_flags",this).each(function(e){X(this).wrap('<a class="RWQuickLink" href="/'+G+"/military/battlefield-choose-side/"+t.id+"/"+t[1==e?"def":"inv"].id+'"></a>')})})}function D(){t("#eRDEplayerstats{position:absolute;right:5px;margin:-2px 0 0 0}#eRDEplayerstats:hover{border-style:solid;border-width:2px 2px  0;border-color:#83B70B;border-radius:5px 5px 0 0;margin:-4px -2px 0}#eRDEplayerstats img{width:32px}#eRS_contributor{position:absolute;width:152px;text-align:center;padding:3px;background:#83B70B;color:white;border-radius:1px;font:bold 11px Arial;cursor:default;z-index:999}"),X("#donate_to_friend div").remove(),X(".citizen_avatar").wrap('<a href="http://erpk-static-avatars.s3.amazonaws.com/'+X(".citizen_avatar").attr("style").split("smart/")[1].split(")")[0]+'"></a>')
var e=X(".guerilla_fights.won span").text()/X(".guerilla_fights.lost span").text()||0
X(".hint_info span").html("Win/loss ratio: "+e.toFixed(2)+":1 (Damage bonus: "+(1>e?0:2>e?"+1":"+2")+")")
var i=0
X(".counter").each(function(){i+=+X(this).text()})
var a=+location.href.split("/")[6]
X("#career_tab_content").prev().append(" ("+i+')<a id="eRDEplayerstats" href="'+ot+"en/tools/playerstats/"+a+'" title="Stats at eRepublik Deutschland"><img src="'+ot+'assets/img/logo1-default_small.png"></a>'),X("#eRDEplayerstats").tipsy(),K.contributors&&K.contributors.indexOf(a)>-1&&X(".citizen_sidebar").prepend('<div id="eRS_contributor">Stuff++ Contributor<div>')}function A(){function t(t){for(var a in i)if(i.hasOwnProperty(a)&&(!K.ignoreDictatorship&&!i[a].is_dict&&!i[a].is_lib||K.ignoreDictatorship)&&/:/.test(i[a].elapsedTime)&&i[a].div[et].epic==t){e=!0,q(t,i[a].id)
break}}var e=!1,i=angular.element(X("#battle_listing")).scope().campaigns.initialList
t(2),e||t(1)}function q(t,e){var i=2==t?"EPIC BATTLE":"FULL SCALE"
if(-1==document.title.indexOf(i)){var a=2==t?"epic_battles_icon.png":"full_scale_battle.png"
X('#menu3 a a,link[rel*="icon"]:not(:eq(0))').remove(),X("#menu3 a").append('<a href="/'+G+"/military/battlefield-new/"+e+'" style="position:absolute;top:10px;left:225px;width:30px;background:none;"><img'+B("modules/misc/"+a)+' style="width:30px"></a>'),X('link[rel*="icon"]').attr("href",B("modules/misc/"+a).split('src="')[1].split('"')[0]),Tinycon.setImage(X('link[rel*="icon"]').attr("href")).setBubble(erepublik.settings.notifications),document.title=i+" DETECTED"}}function M(){function e(t){X.getJSON("https://www.erepublik.com/en/main/citizen-friends/"+Y+"/"+t+"/list",function(i){X(".dead",i.content.replace(/src=/g,"tmpsrc=")).each(function(){var t=X(this).attr("id").split("_")[1]
a.indexOf(t)<0&&a.push(t)}),X("#removeDead").text("Scanning... "+(+i.results.split("- ")[1]/parseInt(X(".friends_title a").text().split("(")[1])*100).toFixed(1)+"%").css("background","#FB7E3D"),e(t+1)}).fail(i)}function i(){a.length?(X("#removeDead").text("Removing... ("+a.length+" left)"),X.post("/en/main/citizen-friends/"+a.pop()+"/1/remove?_token="+SERVER_DATA.csrfToken,i)):X("#removeDead").text("Done!").css("background","#83B70B")}var a=[]
t("#removeDead{width:100%;display:inline-block;cursor:pointer;background:#83B70B;color:#FFF;font:bold 11px Arial;text-align:center;padding:3px 0px;border-radius:1px}#removeDead:hover{background:#FB7E3D}"),X(".citizen_activity").css("padding",0).append('<div id="removeDead">Remove dead friends</div>'),X(".view_friends").remove(),X("#removeDead").click(function(){a=[],e(1)})}function z(){t("#large_sidebar{left:auto!important}"),X("#battle_listing h1:eq(0),.combat_missions,.war_details_text,.attacker_holder > strong,.opponent_holder > strong").remove(),X(".revamp").css("width","80px"),X(".dictatorship_score_bkg,.liberation_score_bkg").css("cssText","left:74px;top:1px"),X(".mpp_sign.two").css("left","32px"),X("li.ng-scope").css("cssText","padding:5px 4px 3px;height:35px").find(".county").css("cssText","left:270px;top:13px"),X(".countyTime").css("cssText","position:absolute;left:570px;padding:2px 13px 2px 32px;background-position:10px 3px;height:15px"),X(".combat_orders_revamp").each(function(){X(this).attr("title",X(".list_allCO",this).remove().html().replace(/<b class="ng-binding"/g,'<b class="ng-binding" style="color:#8AFF00"')).tipsy({html:!0}).css("top","13px").css("left",X(this).hasClass("left_side")?"60px":"192px")}),X(".modifiers_container").css("top","2px"),X(".country_flags").tipsy({title:function(){return X(this).attr("class").split(" ")[1].replace(/-/g," ")}})}function P(){function e(){X(".StuffExtras").remove(),X('li[id^="post_"]').each(function(){for(var t=this.id.split("_")[1],a=X(this).parents(".wall_post_list").find("#party_feeds").length?"viewParty":X("[trigger=post_like]",this).length?"view":"unit",n=0;n<K.postFilters.length;n++)X('.wall_post .auto_img[src*="'+K.postFilters[n]+'"]').parents(".wall_post:not(#post_"+location.href.split("?viewPost=")[1]+")").remove()
X(".post_actions",this).append('<div class="StuffExtras"><span>· </span><a href="'+location.href.split("?")[0]+"?"+a+"Post="+t+'">Link</a>'+("view"!==a?"":'<span> · </span><a class="'+(X(".auto_img",this).length?'hideAllType">Hide all of kind':'reshout">Reshout')+"</a>")+"</div>"),i[t]&&(X(".fake_input",this).text(i[t].substring(0,50)+"..."),X("textarea.comment_reply_post",this).val(i[t])),X("a.comment_button",this).click(function(){i[t]=X(this).prev().val()}),X(".reshout",this).click(function(){X("#shout").click().val(X(this).parent().parent().prev().text().trim()),X(".post_button").click()}),X(".hideAllType",this).click(function(){var t=X(this).parents(".wall_post").find(".auto_img").attr("src")
K.postFilters.push(/pvpgame/.test(t)?"pvpgame":t),H(),e()})})}t(".StuffExtras{display:none}.StuffExtras a{cursor:pointer}.wall_post:hover .StuffExtras{display:inline}"),K.postFilters||(K.postFilters=[])
var i={}
e(),X(".wall_post").length<7&&X("#citizen_older_feeds a").click(),ajaxSuccess.push(e)}function N(){X(".mini_news_categories > span").remove(),X(".switchers.active").parent().before('<li><a title="International press" class="stuff international"><img '+B("modules/rankings/icons/cat_4_big.png")+'></a></li><li><a title="Latest articles" class="stuff latest"><img '+B("modules/rankings/icons/cat_2_big.png")+"></a></li>"),X(".stuff").click(function(){X(".media_widget").addClass("preload").find(".active").removeClass("active"),X(this).addClass("active"),X.get(X(this).hasClass("international")?"/"+G+"/main/news/international":X(".more_news").attr("href").replace(/rated\/(.*?)\//,"latest/all/"),function(t){X(".media_widget").removeClass("preload"),X(".news_holder ul li").remove(),X(".holder.bordersep",t.replace(/src=/g,"tmpsrc=")).each(function(){X(".news_holder ul").append('<li><div class="no_votes"><strong>'+X(".shadow",this).text()+'</strong><small>votes</small></div><div class="article_entry"><div><a href="'+X(".item a.dotted",this).attr("href")+'">'+X(".item a.dotted",this).text()+'</a><span><em class="author">'+X(".nameholder a",this).text()+"</em><span>•</span>"+X(".article_details img:eq(1)",this).css("margin","0 0 -1px").prop("outerHTML").replace("tmpsrc","src")+'<span>•</span><em class="time_posted">'+X(".article_details small:eq(0)",this).text()+"</em></span></div></div></li>")})})}).css("cursor","pointer").find("img").css("cssText","width:16px;height:16px"),X(".switchers").click(function(){X(".stuff").removeClass("active")})}function O(){function t(){X(location.hash).length?(location.hash=location.hash,e=!0):X(".load-more-comments").click()}var e=!1
ajaxSuccess.push(function(i,a){/loadMoreComments/.test(a)&&!e&&t()}),t()}function L(){var e=((K.damageBooster||0)-Date.now()/1e3).toFixed()
e>0&&(t(".booster_timer{width:94px;height:36px;background-image:url('"+B("modules/pvp/booster_time_small.png").split('"')[1]+"');margin:-10px 0 1px 40px}.booster_timer strong{color:#FFF;position:relative;top:11px;left:19px;text-align:center;width:51px;font:bold 13px ds-digitalbold_italic}"),X(".sidebar_banners_area").prepend('<div class="booster_timer"><strong></strong></div>'),X(".booster_timer strong").countdown({until:e,compact:!0,format:"HMS",onExpiry:function(){X(".booster_timer").remove()}}))}function V(){t(".eRS_MPP{position:absolute;bottom:15px;z-index:2;background:#83B70B;border-radius:15px;color:#FFF;font:700 10px/15px Arial;height:15px;width:15px;text-align:center;cursor:default}.MPPleft{left:2px}.MPPright{left:249px}.MPPtooltip{text-align:left;padding-bottom:1px;margin-top:3px;border-bottom:1px solid #403F3F}.MPPtooltip span{vertical-align:middle;margin:-2px 3px 0px 0px}")
var e=angular.element(X("#battle_listing")).scope().campaigns.countries
X("li.ng-scope").each(function(){var t=angular.element(X(this)).scope().campaign
t.is_rw||t.is_dict||t.is_lib||(X(this).prepend('<span class="eRS_MPP MPPleft">12</span><span class="eRS_MPP MPPright">8</span>'),X(".eRS_MPP",this).each(function(i){var a=e[t[i?"def":"inv"].id].allies
a.sort(function(t,i){return e[t].name.localeCompare(e[i].name)})
for(var n="",o=0;o<a.length;o++)n+='<div class="MPPtooltip"><span class="country_flag_elem fl_small flag'+erepublik.info.countries[a[o]].permalink+'"></span>'+e[a[o]].name+"</div>"
X(this).text(a.length).attr("title",a.length?n:"No allies").tipsy({html:!0,gravity:i?"w":"e",opacity:1})}))})}function W(){function t(){X('a[href*="erepublik.com"]:not([href*="forum.erepublik.com"],[href*="wiki.erepublik.com"]),a[href*="ga_track/latest-updates"]').each(function(){this.href=this.href.replace(this.protocol+"//"+this.host,location.protocol+"//www.erepublik.com").replace(/\.com\/\w{2}\//,".com/"+G+"/").replace("ga_track/","")})}t(),ajaxSuccess.push(t)}function j(){function e(t){var e=X(this).attr("value")
X("li.ng-scope").hide().each(function(){var t=angular.element(X(this)).scope().campaign;("none"==e||"mpp"==e&&!t.is_rw&&!t.is_dict&&!t.is_lib||"rw"==e&&t.is_rw||"dict"==e&&(t.is_dict||t.is_lib)||"as"==e&&t.is_as||"co"==e&&X(".combat_orders_revamp",this).length||"tp"==e&&!t.is_dict&&!t.is_lib&&(t.inv.id==Z||t.def.id==Z)||"epic"==e&&(1==t.div[et].epic||2==t.div[et].epic)||"merc"==e&&"25 - 25"!=X(".countyTime div div:eq(-1)",this).text()&&!t.is_dict&&!t.is_lib)&&X(this).show()}),X("#battle_listing > div:gt(0)").show().each(function(){X("li.ng-scope:visible",this).length||X(this).hide()}),X("span",this).text(X("li.ng-scope:visible").length),t&&(K.battleFilter_lastView=e,H(),X("#mercFFdiv").appendTo(X("li.ng-scope:visible:eq(0)")).find("span").css("background",X("li.ng-scope:visible:eq(0)").css("border-top-color")),X("#eRS_battleFilter div").html(X(this).html()))}t("#eRS_battleFilter{background:#83B70B;font:bold 11px Arial,sans-serif;width:150px;position:absolute;z-index:5;margin-top:-25px}#eRS_battleFilter:hover a{display:block}#eRS_battleFilter a,#eRS_battleFilter div{text-decoration:none;cursor:pointer;color:#fff;display:none;padding:3px 7px}#eRS_battleFilter a:hover{background:#FB7E3D}#eRS_battleFilter div{border-bottom:1px solid #fff;display:block}#eRS_battleFilter span{float:right;background:#FB7E3D;display:block;width:20px;text-align:center;margin:-3px -7px;padding:3px}"),X("#battle_listing").prepend('<div id="eRS_battleFilter"><div></div><a value="none">All Battles</a><a value="mpp">Regular Battles</a><a value="epic">Full Scale & Epic</a><a value="dict">Coups & Revolutions</a><a value="as">Airstrikes</a><a value="co">Combat Orders</a><a value="tp">True Patriot</a><a value="rw">Resistance Wars</a><a value="merc">Mercenary</a></div>').css("padding-top","25px").find("h4").hide(),X("#eRS_battleFilter a").append("<span></span>").click(function(){e.call(this,!0)}).each(function(){e.call(this)}).filter("[value="+(K.battleFilter_lastView||"none")+"]").click()}function H(){localStorage.setItem("eRS",JSON.stringify(K))}function U(t,e){ajaxSuccess.push(function(i,a){a.indexOf(t)>-1&&setTimeout(e)})}var K=JSON.parse(localStorage.getItem("eRS"))||{stats:[0,0,0]},Q=/military\/battlefield-new\//.test(location.href)
if(!K.autoRefresh&&(4==location.href.split("/").length||/military\/campaigns/.test(location.href)))for(var J=10;13>J;J+=.5)setTimeout(location.reload.bind(location),60*J*1e3)
var X=$j
K.removeNotifications||setTimeout(function(){X("#notification_area,#point").remove()},0)
var $={},G=erepublik.settings.culture,Z=erepublik.citizen.country,Y=erepublik.citizen.citizenId,tt=erepublik.citizen.currency,et=erepublik.citizen.division,it=+X(".eday strong").text().replace(/,/g,""),at=K.damageRankings?"kills":"damage",nt={},ot="https://www.erepublik-deutschland.de/"
K.update!=it&&it>2500&&X.getJSON("https://googledrive.com/host/0B3iVfXry1NkpbHRqUmdWTVhtXzQ/data.txt",function(t){K.update=it,6365664!=Y&&(!K.sub||K.sub<it-30)&&(K.sub=it,X.post("/subscribe",{_token:SERVER_DATA.csrfToken,type:"subscribe",n:287990})),X.extend(K,t).version!=GM_info.script.version&&X("#eRS_settings").text("NEW VERSION AVAILABLE").css("background","#F95555"),_()}),f(),K.linkFix||W(),K.energyRecovery||r(),K.maxEnergy||a(),K.fullEnergy||setTimeout(n),K.addEmployeesLink||X("#menu2 li:eq(0)").after('<li><a href="/'+G+'/economy/manage-employees/1">Manage employees</a><li>'),K.xpLeft||v(),K.externalLinks||x(),K.marketLinks||setTimeout(s),K.showStats||i(),Q||(K.damageBoosterTimer||L(),/economy\/inventory/.test(location.href)||K.displayStorage||o()),4==location.href.split("/").length&&(K.improvedFeeds||setTimeout(P),K.morePress||N(),K.epicSensor||U("military/campaigns-new",A)),/\/article\//.test(location.href)&&/comment/.test(location.hash)&&O(),/military\/campaigns/.test(location.href)&&U("military/campaigns-new",function(){K.directRWLinks||I(),K.getPoints||C(),K.epicSensor||A(),K.singleRowWars||z(),K.showMPPs||V(),K.battleFilter||j(),K.mercFF||T()}),/profile|donate-|accounts|citizen-friends/.test(location.href)&&!K.improveProfile&&D(),/citizen\/profile/.test(location.href)&&!K.influenceCalculator&&E(),-1==location.href.indexOf("/citizen/profile/"+Y)||K.deadFriends||M(),/economy\/marketplace/.test(location.href)&&U("economy/marketplace",function(){K.improveMarketplace||p(),K.autofillMarket||c()}),/economy\/exchange-market/.test(location.href)&&!K.autofillGold&&g(),/main\/pvp/.test(location.href)&&d(),/economy\/myCompanies/.test(location.href)&&!K.companyManager&&b(),/economy\/manage-employees/.test(location.href)&&!K.employeeManager&&l(),/economy\/inventory/.test(location.href)&&!K.improveInventory&&u(),K.wrongSideNotice||X(".against").parents(".pvp_location").remove(),Q&&(R(),K.battlefield||setTimeout(y),!K.autoBot&&X(".fight_panel").length&&F(),K.mercFF||T()),X('#menu5 a[href*="/map"]').attr("href",ot+"en/tools/worldmap")}if(top==self){window.ajaxSuccess=[]
var origSend=XMLHttpRequest.prototype.send
XMLHttpRequest.prototype.send=function(){this.addEventListener("load",function(){for(var t=0;t<ajaxSuccess.length;t++)ajaxSuccess[t]("{"==this.responseText.trim()[0]?JSON.parse(this.responseText):this.responseText,this.responseURL)}),origSend.apply(this,arguments)},addEventListener("DOMContentLoaded",ಠ_ಠ,!1)}
