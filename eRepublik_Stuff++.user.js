// ==UserScript==
// @name		eRepublik Stuff++
// @version		3.23
// @include		*www.erepublik.com/*
// @grant		none
// @run-at		document-start
// ==/UserScript==
function ಠ_ಠ(){function t(t){$("head").append("<style>"+t+"</style>")}function e(t){return(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function i(){t("#NoKills{cursor:default;font:bold 11px arial;float:left;width:145px;margin:0 3px}#NoKills strong{color:#666}#NoKills span{color:#3c8fa7;float:right}"),$("#NoKills").remove(),$("#eRS_settings").before('<div id="NoKills" title="Click to reset stats"><strong>Kills today:</strong><span>'+e(Q.stats[0])+"</span><br><strong>Hits:</strong><span>"+e(Q.stats[1])+"</span><br><strong>Damage:</strong><span>"+e(Q.stats[2])+"</span></div>"),$("#NoKills").tipsy({gravity:"e"}).click(function(){$(".tipsy").hide(),_()})}function a(){setTimeout(a,1e3),$("#maxRecover").remove(),$("#current_health").after('<strong id="maxRecover" style="text-align:right;margin-right:5px;width:98%;background:none">'+food_remaining+"</strong>")}function o(){function t(t){return 10>t?"0"+t:t}setTimeout(o,1e3),$("#full_energy").remove()
var e=Math.max(360*Math.ceil((reset_health_to_recover-food_remaining)/globalNS.userInfo.energyPerInterval)-360+60*parseInt($("#foodResetHours").text()),0)
$("#current_health").before('<strong id="full_energy" style="text-align:left;left:'+(J?5:15)+'px;background:none">'+t(parseInt(e/3600))+":"+t(parseInt(e%3600/60))+"</strong>").css("padding-left",J?"10px":0)}function n(){t("#sideInventory{position:absolute;background:#FFF;display:none}#sideInventory img,#sideInventory span{float:left;clear:both}#sideInventory img{width:39px;height:39px;background:linear-gradient(#EEF1EC,#D5DECF)}#sideInventory span{font:bold 10px arial;color:#578B4D;background:linear-gradient(#BEE698,#98D780);width:39px;text-align:center;cursor:default}.col{line-height:19px}#storageCapacity{float:left;color:#5a5a5a;text-shadow:0 1px 0 rgba(255,255,255,.9);font-size:11px;cursor:default}#storageCapacity img{float:left;margin:-1px 6px 0 2px;width:22px;height:16px}#storageCapacity strong{margin:0 1px}"),$(".currency_amount").after('<div id="storageCapacity"><img src="/images/modules/manager/tab_storage.png"><strong>Loading...</strong></div>'),$.getJSON("/"+Z+"/economy/inventory-items/",function(t){$("body").prepend('<div id="sideInventory"></div>')
var i=0,a=0
$.each($.extend(t.inventoryItems.finalProducts.items,t.inventoryItems.rawMaterials.items),function(t,o){o.industryId&&$("#sideInventory").append('<img src="'+o.icon+'" '+(o.attributes.expiration?'title="'+o.attributes.expiration.name+'"':"")+"><span>"+(o.active?(o.active.time_left/3600).toFixed(0)+"h":e(o.amount))+"</span>"),a+=1==o.industryId&&o.quality<8?o.amount*o.attributes.energyRestore.value:0,i+=o.amount*("1_10"==o.id?10:"1_11"==o.id?20:0)}),$("#sideInventory").fadeIn(500).find("img").tipsy({gravity:"w"}),$("#storageCapacity").attr("title",'Free space: <span class="col defense">'+e(t.inventoryStatus.totalStorage-t.inventoryStatus.usedStorage)+'</span><br>Total EB hits: <span class="col defense">'+e(i)+'</span></span><br>Total food HP: <span class="col defense">'+e(a)+"</span>").tipsy({gravity:"e",html:!0,opacity:1}).find("strong").text(e(t.inventoryStatus.usedStorage)+" / "+e(t.inventoryStatus.totalStorage))})}function r(){function t(){"AUTOBOT ON"==$("#AutoBotSwitch").text()||!Q.lvlUpNoRecovery&&globalNS.userInfo.wellness+food_remaining>10*($("#experienceTooltip strong:eq(2)").text()-$("#experienceTooltip strong:eq(1)").text())||globalNS.userInfo.wellness>=reset_health_to_recover||food_remaining<smallestFood.use||$.getJSON("/"+Z+"/main/eat?format=json&_token="+SERVER_DATA.csrfToken+"&buttonColor=blue",function(t){energy.processResponse(t)})}t()
var e=setInterval(t,3e3)
$("#fight_btn").click(function(){clearInterval(e),e=setInterval(t,3e3)})}function s(){function e(t,e){return'<li><a href="/'+Z+"/economy/marketplace#"+Y+"/"+t+"/"+e+'"><img src="/images/icons/industry/'+t+"/"+(t>4?"default":"q"+e)+'.png"> '+(1==t?"Food Q"+e:2==t?"Weapons Q"+e:3==t?"Tickets Q"+e:4==t?"Houses Q"+e:7==t?"Food Raw":12==t?"Weapon Raw":"House Raw")+"</a></li>"}t(".eRS_quickMarket{display:none;position:relative;top:-61px}.eRS_quickMarket img{width:18px;height:20px;vertical-align:middle;margin-bottom:2px}#menu4 ul li:nth-child(1):hover > .eRS_quickMarket{display:block}")
for(var i="",a=1;5>a;a++){i+='<div class="eRS_quickMarket" style="'+(1==a?"right:401px":2==a?"right:264px":3==a?"":"left:138px")+'"><ul>'
for(var o=1;8>=o;o++)i+=1==a&&8==o?e(7,1):2==a&&8==o?e(12,1):4==a&&6==o?e(17,1):3==a&&o>5||4==a&&o>6?"":e(a,o)
i+="</ul></div>"}$("#menu4 ul li:eq(0)").append(i).find("a").click(function(){location.href=this.href,location.reload()})}function l(){t("#changeAll{cursor:pointer;background:#83B70B;border:1px;color:#fff;font:bold 11px arial;height:24px}#changeAll:hover{background:#FB7E3D}#eRS_same_all{margin:0 5px;width:40px;text-align:right}"),$(".area h4").append('<div style="float:right"><input type="text" class="field" id="eRS_same_all"><button id="changeAll">Change for All</button></div>'),$.get("/"+Z+"/economy/job-market/"+Y,function(t){$("#eRS_same_all").val(parseFloat($("strong,sup",$(".jm_salary:eq(1)",t.replace(/src=/g,"tmpsrc="))).text())),1==$(".active_offers:not(.daily_budget) .job_salary").text().length&&$("#job_salary_value").val($("#eRS_same_all").val()),$("#changeAll").click(function(){$("input[id^=salary_value_]").val($("#eRS_same_all").val()),$("a[id^=save_salary_]").each(function(t){setTimeout(executeAction,3e3*t,$(this),"update_salary")})})}),$(".bottom_details").css("cssText","position:sticky;bottom:0"),$(".list_group").css("box-shadow","none"),$("#edit_mode").after('<a id="SortButton" class="std_global_btn smallSize blueColor employees" title="Sort by salary"><span></span></a><a href="/'+Z+"/economy/job-market/"+Y+'" class="std_global_btn smallSize blueColor employees" title="Go to job market"><span>M</span></a>'),$("#SortButton").click(function(){var t=$(".current_salary").map(function(){return{wage:$(this).text().split(" ")[0],row:$(this).parent().parent()}}).get()
"↑"!=$("#SortButton span").text()?($("#SortButton span").text("↑"),t.sort(function(t,e){return e.wage-t.wage})):($("#SortButton span").text("↓"),t.reverse())
for(var e=0;e<t.length;e++)$(".list_group").append(t[e].row)}).click()}function p(){$(".eRS_CostperUse,#eRS_otherMarket").remove()
var e=angular.element($("#marketplace")).scope().settings,i=[e.countryId,e.industryId,e.lastQuality],a=i[0]==Y?erepublik.citizen.countryLocationId:Y
$("#eRS_erepDE").length?$("#eRS_erepDE")[0].href=rt+"en/tools/marketplace/0/"+f(i[1])+"/"+i[2]:(t("#eRS_otherMarket{background:#83B70B;color:#FFF;padding:0 4px;border-radius:2px;float:right;cursor:pointer}#eRS_otherMarket:hover{background:#FB7E3D}#eRS_otherMarket span{background:#FB7E3D;float:right;margin:0 -4px 0 4px;padding:0 4px;border-radius:2px}#eRS_erepDE{height:30px;float:right;margin:0 70px -10px 10px}#eRS_erepDE img{height:30px}#eRS_erepDE img:hover{transform:scale(1.2,1.2);transition:transform 0.5s}.eRS_CostperUse{width:110px;text-align:center;font-size:14px}.item_quantity_wrapper{width:125px;padding:1px;border:1px solid transparent}"),$("#marketplace h1:eq(0)").append('<a id="eRS_erepDE" href="'+rt+"en/tools/marketplace/0/"+f(i[1])+"/"+i[2]+'" title="Find the best offers globally"><img src="'+rt+'assets/img/logo1-default_small.png"></a>'),$("#eRS_erepDE").tipsy()),(erepublik.citizen.countryLocationId!=Y||i[0]!=Y)&&h(a,function(){var t=((nt[a][f(i[1])]["q"+i[2]]||[])[0]||{}).gross
$("#marketplace h1:eq(0)").append('<a id="eRS_otherMarket">'+erepublik.info.countries[a].name+"<span>"+(t?t.toFixed(2)+et:"No offers")+"</span></a>"),$("#eRS_otherMarket").click(function(){$("#countryId").val(a).change()})}),i[1]<2&&($("#marketplace thead .m_stock").after('<th class="eRS_CostperUse">'+et+" / HP</th>"),$("#marketplace .price_sorted tr").each(function(){$(".m_stock",this).after('<td class="stprice eRS_CostperUse">'+(parseFloat($(".m_price",this).text())/industryJSON[i[1]].attributes[i[2]].effect).toFixed(4)+"</td>")}))}function c(){$(".m_buy a").each(function(){$(this).data("max",$(this).attr("data-max")).data("price",$(this).attr("data-price"))}),$(".quantity_button.maximum").click()}function d(){$("#back_to_battle").click(function(){Q.stats[0]++,Q.stats[2]+=+$(".award_damage strong").text(),U()})}function g(){function t(){$("button[data-currency=GOLD]").each(function(){erepublik.exchange.displayPrice($(this).parent().find("input").val(Math.min($(this).attr("data-max"),10,Math.floor(100*$("#eCash").val()/$(this).attr("data-price"))/100)))}).css("max-width","unset"),$(".ex_citizen").css("width","190px"),$(".ex_amount").css("padding-right","30px")}ajaxSuccess.push(t),t()}function u(){function i(){$('tr[id^="offer_"]:visible').each(function(){$(".std_global_btn.smallSize.blueColor,.Net_unit,.Total_net,.share_offer",this).remove()
var t=this,i=$.map(erepublik.info.countries,function(e,i){return e.permalink==$(".offer_flag",t).attr("src").split("/M/")[1].split(".")[0]?i:null})[0],a=$(".offer_image",this).attr("src").split("/industry/")[1].split("/"),o=/q/.test(a[1].split("_")[0])?a[1].split("_")[0].replace("q",""):1,n=countryList[i].taxes[a[0]],r=$(".offer_price strong",this).text().replace(/,/g,"")/((100+(+n.value_added_tax+(i!=Y?+n.import_tax:0)))/100),s=r*$(".offer_amount",this).text().replace(/,/g,"")
$(".offer_price",this).after('<td class="Net_unit"><strong>'+r.toFixed(4)+"</strong> "+et+'</td><td class="Total_net"><strong>'+e(s.toFixed(2))+"</strong> "+et+"<br><span>"+e((s/Q.goldPrice.price).toFixed(2))+"</span><span> g</span></td>"),$(".delete_offer",this).before('<a title="Visit market" class="std_global_btn smallSize blueColor" href="/'+Z+"/economy/marketplace#"+i+"/"+a[0]+"/"+o+'"><span>M</span></a><a class="std_global_btn smallSize blueColor" href="https://www.erepublik.com/en/economy/marketplace/offer/'+this.id.split("_")[1]+'" title="Share offer"><span>O</span></a>')})}t("td:last-child,#Net_unit,.Net_unit,#Total_net,.Total_net,#Total_netF{padding-left:0!important}.Total_net,#Total_netF{padding:15px;text-align:right}.Total_net span,#Total_netF span{font-size:11px}.delete_offer{opacity:1!important}td .std_global_btn.smallSize.blueColor{float:left;margin:-8px 0px 0px 12px;padding:0px 15px}tfoot tr{background:#F7FCFF;height:44px}#eRS_totalFoodHP{float:right;margin:5px 30px 0px;color:#656565}"),K("inventory-items",function(){var t=$(".area.storage h4:first strong").text().replace(/[,()]/g,"").split("/"),i=0
$(".product_list li").each(function(){var t=$(this).attr("industry"),e=$(this).attr("quality"),a=$("strong",this).text().replace(/,/g,"")
1==t&&8>e&&(i+=a*(7>e?2*e:20)),itemAmounts[t][e]=a}),$("tr[id^=offer_]").each(function(){var t=$(".offer_image",this).attr("src").split("industry/")[1].split("_")[0].split("/q")
1==t[0]&&(i+=$(".offer_amount",this).text().replace(/,/g,"")*(t[1]<7?2*t[1]:20))}),$(".area.storage h4:first strong").append(" Free space: "+e(t[1]-t[0])).parent().append('<span id="eRS_totalFoodHP">Total food: '+e(i)+"HP</span>")}),$("th input").css("width","50px"),$(".offers_product").css("width","70px").next().css("width","80px").next().css("width","120px").next().css("width","60px").next().css("width","132px").find("a").css("cssText","left:10px;margin-right:20px;padding:0 10px"),$("#sell_offers table").append('<tfoot><tr><td colspan="4"><td id="Total_netF"></td><td colspan="2"></td></tr></tfoot>'),Q.goldPrice=Q.goldPrice||{},Q.goldPrice.date!=at&&$.post("/"+Z+"/economy/exchange/retrieve/",{_token:SERVER_DATA.csrfToken,page:1,currencyId:62},function(t){Q.goldPrice.price=t.split("data-price='")[1].split("'")[0],Q.goldPrice.date=at,U()}),setInterval(function(){var t=0
$(".Total_net:visible").each(function(){t+=+$("strong:eq(0)",this).text().replace(/,/g,"")}),$("#Total_netF").html("<strong>"+e(t.toFixed(2))+"</strong> "+et+"<br><span>"+e((t/Q.goldPrice.price).toFixed(2))+"</span><span> g</span>"),$("#Net_unit,#Total_net").remove()
var i=$("#market_select").attr("country"),a=countryList[i].taxes[$("#sell_product").attr("src").split("/industry/")[1].split("/")[0]],o=(+$("#sell_price").val()||0)/((100+(+a.value_added_tax+(i!=Y?+a.import_tax:0)))/100),n=o*(+$("#sell_amount").val()||0)
$(".offers_price").after('<th id="Net_unit"><strong>Net/unit</strong><b>'+o.toFixed(4)+" "+et+'</b></th><th id="Total_net"><strong>Total Net Value</strong><b>'+e(n.toFixed(2))+" "+et+"</b><b>"+e((n/Q.goldPrice.price).toFixed(2))+" g</b></th>")},100),$(".sell_selector .industry_quality_selector").click(function(){var t=Math.max($(this).attr("quality"),1),e=$(this).attr("industry"),i=$("#market_select").attr("country")
$("#sell_amount").val(Math.min(itemAmounts[e][t]-(itemPartials[e]?!!itemPartials[e][t]:0),99999))
var a=$("img",this).attr("src").split("/industry/")[1],o=0
$('tr[id^="offer_"]:visible .offer_image').each(function(){$(this).attr("src").split("/industry/")[1]==a&&(o=$(this).parent().parent().find(".offer_price strong").text().replace(/,/g,""),setTimeout(function(){$("#sell_price").val(o)},0))}),o||(setTimeout(function(){$("#sell_price").val(0)},0),h(i,function(){$("#sell_price").val(((nt[i][f(e)]["q"+t]||[])[0]||{}).gross||minPrices[i][e][t])}))}),i(),ajaxSuccess.push(function(t,e){i(),/postMarketOffer/.test(e)&&$("#sell_amount").val(Math.min(itemAmounts[t.token.industryId][t.token.customization],99999))})}function h(t,e){nt[t]?setTimeout(e):$.getJSON("/"+Z+"/economy/marketpicture/"+t,function(i){nt[t]=i,e()})}function f(t){return 1==t?"food":2==t?"weapons":3==t?"tickets":4==t?"houses":7==t?"frm":12==t?"wrm":"hrm"}function m(){t("#eRS_block{display:none;z-index:999998;position:fixed;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6)}#eRS_settings{margin:5px 0 -5px;width:100%;display:inline-block;cursor:pointer;background:#83B70B;color:white;font:bold 11px Arial;text-align:center;padding:3px 0px;border-radius:1px}#eRS_options{background:black;box-shadow:0 1px 4px;display:none;width:600px;cursor:default;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999999;border-radius:5px}#eRS_settings:hover,#eRS_options a:hover{background:#FB7E3D}#eRS_settings span{float:right;background:#FB7E3D;margin:-3px 0;padding:3px 7px}#eRS_options a{cursor:pointer;color:white;font-weight:bold;background:#83B70B;padding:5px;margin:20px;border-radius:1px}#eRS_options input{float:right;margin:2px 10px}#eRS_options label{color:white;padding:2px 5px;display:inline-block;width:96.7%;font-size:13px}#eRS_options label:hover{background:#5f5757}#eRS_options span{background:#FB7E3D;color:white;padding:2px;font-weight:bold;display:inline-block;width:98.7%;text-align:center}")
for(var e=[["Battlefield",[["Improve battlefield","battlefield"],["Enable AutoBot","autoBot"],["Automatically close wrong side warning","wrongSideNotice"]]],["Companies",[["Company manager","companyManager"],["Employee manager","employeeManager"],["Add employees link to My places","addEmployeesLink"]]],["Energy",[["Automatic energy recovery","energyRecovery"],["Stop recovery to maximize level-up refill","lvlUpNoRecovery"],["Show remaining time to full energy bar","fullEnergy"],["Show maximum energy to recover","maxEnergy"]]],["Main page",[["Improve feeds","improvedFeeds"],["Add international and latest articles","morePress"]]],["Marketplace",[["Improve marketplace","improveMarketplace"],["Autofill maximum product amount","autofillMarket"],["Add direct market links to main menu","marketLinks"]]],["Monetary market",[["Autofill maximum gold amount","autofillGold"]]],["Profile",[["Improve profile page","improveProfile"],["Influence calculator","influenceCalculator"],["Remove dead friends tool","deadFriends"]]],["Storage",[["Improve inventory","improveInventory"],["Display storage everywhere","displayStorage"]]],["Wars page",[["Show dom. points and wall percentages","getPoints"],["Add direct links for each side in RWs","directRWLinks"],["Single row layout","singleRowWars"],["Display allies in MPP battles","showMPPs"],["Battle filter","battleFilter"]]],["Other",[["Autorefresh main page every 10 minutes","autoRefresh"],["Display XP needed to level-up","xpLeft"],["Kills, hits, and damage on sidebar","showStats"],["Hide notifications","removeNotifications"],["Epic battle sensor","epicSensor"],["Ignore epic dictatorship battles","ignoreDictatorship"],["Top5 lists by damage instead of kills","damageRankings"],["Show active damage boosters everywhere","damageBoosterTimer"],["Show Merc, FF, and TP progress","mercFF"],["Remove external link warning","externalLinks"],["Autocorrect link protocol and language","linkFix"],["Display player info tooltip on hover","playerTooltip"]]]],i="",a=0;a<e.length;a++){a&&7!=a||(i+='<div style="width:48%;margin:1%;float:left;background:#242B27">'),i+="<span>"+e[a][0]+"</span>"
for(var o=0;o<e[a][1].length;o++)i+="<label>"+e[a][1][o][0]+'<input type="checkbox" id="'+e[a][1][o][1]+'"></label>';(6==a||9==a)&&(i+="</div>")}$("body").append('<div id="eRS_block"></div><div id="eRS_options"><div style="position:absolute;top:-20px;width:100%;text-align:center"><a href="https://docs.google.com/spreadsheets/d/1nal62cgC7lUmrur6NRzlPVU3uxtE59WGV9-bZcPoIw8/edit">Script Homepage</a><a id="reset" title="Deletes all stored data (settings, stats, caches). If you use other eRepublik scripts utilizing localStorage, their data will be deleted, too.">RESET</a><a href="https://googledrive.com/host/0B3iVfXry1NkpbHRqUmdWTVhtXzQ/eRepublik_Stuff++.user.js">UPDATE</a><a href="/'+Z+'/citizen/profile/6365664">Contact / Donate</a><a>Close</a></div>'+i+"</div>"),setTimeout(Q.x),$("#eRS_options input").each(function(){$(this).prop("checked",!Q[$(this).attr("id")])}).change(function(){Q[$(this).attr("id")]=!$(this).prop("checked"),U()}),$("#eRS_options a:last,#eRS_block").click(function(){$("#eRS_options,#eRS_block").hide()}),$(".user_finances").after('<div id="eRS_settings" title="Click to open settings">eRepublik Stuff++<span>'+GM_info.script.version+"</span></div>"),$("#eRS_settings").tipsy({gravity:"e"}).click(function(){$("#eRS_options,#eRS_block").show()}),$("#reset").click(function(){localStorage.clear(),location.reload()})}function _(){Q.stats=[0,0,0],U(),Q.showStats||i()}function x(){function t(){$('a[href*="/main/warn/"]').each(function(){var t=$(this).text().replace(/[;:.,]+$/,""),e=/https?:\/\/[a-zA-Z0-9][.]+$/,i=$(this)[0].previousSibling||{},a=$(this)[0].nextSibling||{}
if((4==location.href.split("/").length||/www\.|https?:\/\//.test(t))&&$(this).attr("href",/https?:\/\//.test(t)?t:"http://"+t).after(/[;:.,]+$/.exec($(this).text())).text(t),e.test(i.nodeValue||"")){var o=e.exec(i.nodeValue)
$(this).text(o+$(this).text()).attr("href",$(this).text()),i.nodeValue=i.nodeValue.split(o)[0]}if("'"==(a.nodeValue||"")[0]){var n=a.nodeValue.split(" ")[0]
$(this).text($(this).text()+n).attr("href",$(this).text()),a.nodeValue=a.nodeValue.split(n)[1]}/main\/warn/.test($(this).attr("href"))&&$.get($(this).attr("href"),$.proxy(function(t){$(this).attr("href",t.split('class="content"')[1].split('href="')[1].split('"')[0])},this))})}ajaxSuccess.push(function(e,i){/main\/warn|\/eat|\/inventory|\/campaigns/.test(i)||t()}),t()}function v(){$("#xpleft").remove()
var t=$("#experienceTooltip strong:eq(2)").text()-$("#experienceTooltip strong:eq(1)").text()
$(".user_level").append('<div id="xpleft" style="float:right;position:relative;font-size:10px;color:#777;'+(J?'top:-3px;left:23px"><span style="':'top:14px">XP left: <span style="padding:1px')+";background:"+(reset_health_to_recover<=10*t?"#6ebce5":"red")+';color:white;font-weight:bold;border-radius:2px">'+t+"</span></div>"),setTimeout(v,200)}function b(){t("#CompanyManager{float:right}#CompanyManager strong{position:relative;bottom:8px;right:5px;font-size:12px}#CompanyManager span{cursor:pointer;border-radius:3px}#CompanyManager span:hover{opacity:0.5}#CompanyManager img{height:30px}")
for(var e=[0,0,0],i=1;15>=i;i++)e[5>=i?0:10>=i?1:2]+=pageDetails.resources[i].bonus
$(".area h4 a").remove(),$(".area h4").append('<span style="float:left;margin:23px 1px -100%;color:#656565;font:90% bold">Food: <b>+'+e[0]+"%</b> Weapon: <b>+"+e[1]+"%</b> House: <b>+"+e[2]+'%</b></span><div id="CompanyManager"><strong>Work as Manager</strong></div>'),$(".area h4 b").each(function(){$(this).css("color",100==parseInt($(this).text())?"#83B70B":parseInt($(this).text())>0?"#FB7E3D":"#D74A4A")}),$(".listing.companies:not(.disabled) .area_pic > img").each(function(){$('#CompanyManager img[src="'+$(this).attr("src")+'"]').length||$("#CompanyManager").append('<span><img src="'+$(this).attr("src")+'" title="'+$('.listing.companies .area_pic > img[src="'+$(this).attr("src")+'"]:eq(0)').attr("title")+'"></span>')}),$("#CompanyManager span").click(function(){$(".listing.companies:not(.disabled) .area_pic > img").parent().parent().find(".owner_work").removeClass("active"),window.pageDetails.recoverable_health.value=food_remaining,$('.listing.companies:not(.disabled) .area_pic > img[src="'+$("img",this).attr("src")+'"]:lt('+Math.floor((globalNS.userInfo.wellness+Math.min(pageDetails.recoverable_health.value,pageDetails.recoverable_health_in_food))/10)+")").parent().parent().find(".owner_work:not(.active)").addClass("active"),$(".listing.companies:not(.disabled)").each(function(t,e){applyCheck(e),warnForCritical()})})}function y(){t("#boosters_timers{bottom:110px!important;left:5px}#special_items_list,.deploy_bomb{display:block!important}#switch_side,#dmg_sum{position:absolute;background:#83B70B;color:#FFF;padding:3px;font:bold 11px Arial}#switch_side{right:37px}#switch_side:hover{background:#FB7E3D;cursor:pointer}#dmg_sum{display:none;left:600px;top:0}#pvp .campaign_details .entry em{opacity:1}#pvp .campaign_details .entry .pdomi_left em{right:5px}#eRSTravel{display:none;position:absolute;top:0;right:115px;background:#4B4B49;border:1px solid #333;color:#FFF;font:11px Arial;padding:1px 4px}#round_number{position:absolute;color:white;text-align:center;width:100%;font:13px ds-digitalbold_italic;top:26px}.top5_list{visibility:visible;position:absolute;top:-6px;padding:2px 0;border-radius:2px;background:rgba(0,0,0,0.6);color:white;cursor:default;z-index:31;font:bold 9px Arial,sans-serif}.top5_list a{color:#83B70B;margin:0 3px}.top5_list span{float:right;margin:0 3px}#right_top5{right:0}#campaign_top5{top:60px}#personal_stats{cursor:default;text-align:center;position:absolute;top:7px;width:100%;color:#FFE49B;font:bold 11px Arial,sans-serif}.eRS_hasBudget span{color:#FFE49B}"),$("#drop_part,#special_weapons_go,.battle_heroes,#changeLocationHeaderBtn").remove(),$(".weapon_link").removeAttr("target"),$("#special_items_list").append($(".addon").children()),$(".deploy_bomb").hide(),$("#booster_list").click(function(){$(this).hide()}),$.cookie("collection_full",1,{expires:999,path:"/"}),clearInterval(globalSleepInterval),k(),$(".status_bar").append('<div id="dmg_sum"></div>'+($(".country_avatar.dictatorship").length?"":'<a id="switch_side">SWITCH SIDE</a>'))
var e=regionsInvolved[rightBattleId]
$("#pvp").append('<select id="eRSTravel"><option>Select region</option></select><div id="round_number">Round '+SERVER_DATA.zoneId+"</div>")
for(var i in e)e.hasOwnProperty(i)&&$("#eRSTravel").append('<option value="'+e[i].id+'">'+e[i].name+(e[i].current_owner_country_id!=e[i].original_owner_country_id?"*":"")+"</option>")
$("#switch_side").click(function(){SERVER_DATA.isResistance?location.href="/"+Z+"/military/battlefield-choose-side/"+SERVER_DATA.battleId+"/"+rightBattleId:$("#eRSTravel").toggle()}),$("#eRSTravel").change(function(){"Select region"!=$("option:selected",this).text()&&(confirm("Are you sure you want to change location?")?$.post("/"+Z+"/main/travel/",{battleId:SERVER_DATA.battleId,_token:SERVER_DATA.csrfToken,toCountryId:rightBattleId,inRegionId:$("option:selected",this).attr("value")},function(t){location.reload()}):$("#eRSTravel").hide())}),$(".dropdown_filter").after('<div class="data_filters_div dropdown_filter"><label>Top5 list settings</label><br><select id="eRS_killsdamage"><option value="damage">Damage</option><option value="kills">Kills</option></select></div><div class="data_filters_div dropdown_filter"><select id="eRS_division"><option value="1">Division 1</option><option value="2">Division 2</option><option value="3">Division 3</option><option value="4">Division 4</option></select></div>'),$("#eRS_killsdamage").val(ot).change(function(){ot=$(this).val(),Q.damageRankings="kills"==ot,U(),k()}),$("#eRS_division").val(it).change(k)}function k(t){if("undefined"==typeof right_percent)return setTimeout(k,100)
$(".activated").text()&&$(".activated").css("cssText","display:"+($(".condition").length?"block;":"none;")+((SERVER_DATA.mustInvert?100-current_domination:current_domination)<Math.max.apply(null,$("strong[data-bind=mu_treshold]").map(function(){return parseInt($(this).text())}).get())?"filter:hue-rotate(110deg);-webkit-filter:hue-rotate(110deg)":"filter:none;-webkit-filter:none")),$(".top5_list").remove(),$("#battleConsole").append('<div id="left_top5" class="top5_list"></div><div id="right_top5" class="top5_list"></div><div id="campaign_top5" class="top5_list"></div>')
for(var i=(currentStats[SERVER_DATA.zoneId]||{})[$("#eRS_division").val()]||{},a=(i[leftBattleId]||{})["top_"+ot]||[],o=(i[rightBattleId]||{})["top_"+ot]||[],n=((overallStats[0]||{})[leftBattleId]||{})["top_"+ot]||[],r='<a href="/'+Z+"/citizen/profile/",s=0;s<a.length;s++)$("#left_top5").append(r+a[s].citizen_id+'">'+fightersData[a[s].citizen_id].name+"</a><span>"+e(a[s]['hits'])+"</span><span>"+e(a[s]['kills'])+"</span><span>"+e(a[s][ot])+"</span><br>")
for(var l=0;l<o.length;l++)$("#right_top5").append(r+o[l].citizen_id+'">'+fightersData[o[l].citizen_id].name+"</a><span>"+e(o[l]['hits'])+"</span><span>"+e(o[l]['kills'])+"</span><span>"+e(o[l][ot])+"</span><br>")
for(var p=0;p<n.length;p++)$("#campaign_top5").append(r+n[p].citizen_id+'">'+fightersData[n[p].citizen_id].name+"</a><span>"+e(n[p]['hits'])+"</span><span>"+e(n[p]['kills'])+"</span><span>"+e(n[p][ot])+"</span><br>")
for(var c=t||aoeBattleData.campaigns,d=0;d<c.length;d++)$("#label"+c[d].id+" .condition").prev().html(c[d].reward+et+"/mil <span>Σ"+e(c[d].budget)+et+"</span>").addClass("eRS_hasBudget")
var g=currentEpicZoneSituation[$("#eRS_division").val()]
g&&D(g,SERVER_DATA.battleId),$("#dmg_sum").text((2==g?"Epic":1==g?"Full":"Cold")+" "+w(S(i[leftBattleId]||{})+S(i[rightBattleId]||{}),1)).show(),$(".notifier").is(":visible")&&$(".close_console").show().css("z-index",1)
var u=(((personalStats[SERVER_DATA.zoneId]||{})[leftBattleId]||[]).top_damage||[])[0]||{}
return $("#personal_stats").length?void 0:0===+$("#total_damage strong").text()||u.damage?void $("#total_damage").after('<div id="personal_stats"><q>'+e(u.kills||0)+"</q> | <q>"+e(u.hits||0)+"</q> | <q>"+e(u.damage||0)+"</q></div>").hide():setTimeout(battleStats.getBattleStats,500)}function w(t,e){return t>1e9?(t/1e9).toFixed(e+1)+"B":(t/1e6).toFixed(e)+"M"}function S(t){function e(){var t=i[i.length-1]-s/1.5
t>0&&(i.push(t),e())}for(var i=[],a=t.top_damage||[],o=t.top_kills||[],n=0;n<a.length;n++)i.push(+a[n].damage)
for(var r=0;r<o.length;r++)i.indexOf(+o[r].damage)<0&&i.push(+o[r].damage)
i.sort(function(t,e){return e-t})
var s=(i[0]-i[i.length-1])/(i.length-1)
return 5==a.length&&e(),i.length?i.reduce(function(t,e){return t+e}):0}function R(){ajaxSuccess.push(function(t,a){if(!/military\/fight-shooot|military\/deploy-bomb/.test(a)||t.error||"ENEMY_KILLED"!=t.message&&"OK"!=t.message)/military\/nbp-stats/.test(a)&&!Q.battlefield?setTimeout(k,0,t.campaigns):/fight-activateBooster/.test(a)&&"damage"==t.type&&(Q.damageBooster=t.activeBooster.remaining+Date.now()/1e3,U())
else{var o=0;/military\/deploy-bomb/.test(a)?o=t.bomb.damage:(o=t.user.givenDamage,Q.stats[1]+=t.user.earnedXp,$("#personal_stats q:eq(1)").text(e(+$("#personal_stats q:eq(1)").text().replace(/,/g,"")+t.hits)),t.oldEnemy.isNatural&&(o+=Math.floor(.1*o))),Q.stats[0]++,Q.stats[2]+=o,$("#personal_stats q:eq(0)").text(e(+$("#personal_stats q:eq(0)").text().replace(/,/g,"")+1)),$("#personal_stats q:eq(2)").text(e(+$("#personal_stats q:eq(2)").text().replace(/,/g,"")+o)),U(),Q.showStats||i(),G.current+=o,G.done+=o,G.current>=G.next&&(G.next+=1e8,G.done=Math.max(G.done-1e8,0)),$("#mercenary q").text(Math.min(+$("#mercenary q").text()+1,25)),$("#freedom_fighter q:eq(0)").text(Math.min(+$("#freedom_fighter q:eq(0)").text()+1,75)),$("#true_patriot q").text((G.done/(G.next-G.current+G.done)*100).toFixed(2))}})}function F(){function i(t){"AUTOBOT OFF"==$("#AutoBotSwitch").text()||t!=o||$("#kills").val()<=0&&!$("#allin").is(":checked")||(setTimeout(i,3e3,++o),$.post("/"+Z+"/military/fight-shooot/"+SERVER_DATA.battleId,{sideId:SERVER_DATA.countryId,battleId:SERVER_DATA.battleId,_token:SERVER_DATA.csrfToken},function(t){return("UNKNOWN_SIDE"==t.message||"WRONG_SIDE"==t.message)&&(location.href=t.url),"SHOOT_LOCKOUT"==t.message?setTimeout(i,100,o):"ENEMY_ATTACKED"==t.message||"LOW_HEALTH"==t.message?a(0):($("#allin").is(":checked")||$("#kills").val($("#kills").val()-1),$("#rank_min").text(e(t.rank.points)+" Rank Points"),$("#rank_status_gained").css("width",t.rank.percentage+"%"),window.totalPrestigePoints+=t.hits,$("#prestige_value").text(e(window.totalPrestigePoints)),$("#side_bar_currency_account_value").text(e(t.details.currency)),$(".left_player .energy_progress").css("width",t.details.current_energy_ratio+"%"),$(".right_player .player_name").text(t.enemy.name),$(".right_player .energy_progress").css("width",t.enemy.energyRatio+"%"),$(".weapon_no").text(t.user.weaponQuantity),globalNS.updateSideBar(t.details),void a(t.details.wellness))}))}function a(t){setTimeout(function(){return!$("#eatEB").is(":checked")&&!food_remaining&&10>t||$("#kills").val()<=0&&!$("#allin").is(":checked")?$("#AutoBotSwitch").click():!Q.lvlUpNoRecovery&&t+food_remaining>=10*($("#experienceTooltip strong").eq(2).text()-$("#experienceTooltip strong").eq(1).text())||!$("#eatEB").is(":checked")&&!food_remaining||t>=($("#allin").is(":checked")?90:10)?i(o):(setTimeout(i,3e3,o),void $.getJSON("/"+Z+"/main/eat?format=json&_token="+SERVER_DATA.csrfToken+"&buttonColor="+($("#eatEB").is(":checked")?"orange":"blue"),function(t){setTimeout(i,100,o),energy.processResponse(t)}))},parseInt(tt%558?"44C":"28A",16))}t("#AutoBot{background:#242B27;position:absolute;top:320px;border-radius:3px;color:white;font-size:12px;font-weight:bold;line-height:20px;text-align:center;z-index:31}#AutoBot input{margin:3px}#AutoBotSwitch{cursor:pointer;width:100%;background:#FB7E3D}#AutoBotSwitch:hover{background:#83B70B!important}"),$(".battle_footer").after('<div id="AutoBot"><div style="padding:5px">Kills:<input id="kills" type="text" size="1" value="25" style="text-align:center"><label><input id="allin" type="checkbox">All-in</label></br><label><input id="eatEB" type="checkbox">Eat energy bars</label></div><div id="AutoBotSwitch">AUTOBOT OFF</div></div>')
var o=0
$("#AutoBotSwitch").click(function(){"AUTOBOT OFF"==$(this).text()?($("#AutoBotSwitch").text("AUTOBOT ON").css("background","#83B70B"),pomelo.disconnect(),i(o)):($("#AutoBotSwitch").text("AUTOBOT OFF").css("background","#FB7E3D"),connectBattleSocket())}),$("#allin").change(function(){$("#kills").prop("disabled",$(this).is(":checked"))})}function T(){$(".country_avatar.dictatorship").length||$.get("/"+Z+"/citizen/profile/"+tt,function(e){t("#mercenary,#freedom_fighter,#true_patriot{color:#FFF;padding:3px;font:bold 11px Arial;position:absolute;top:0;width:40px}#mercFFdiv{position:absolute;bottom:46px;right:5px}#mercFFdiv span{cursor:default;border-radius:1px;padding:3px;color:#4C4C4C;background:"+$("li.ng-scope:visible:eq(0)").css("border-top-color")+";font:bold 11px arial;margin:3px}#mercenary{left:181px;background:#FB7E3D}#freedom_fighter{left:227px;background:#83B70B}#true_patriot{left:"+($(".resistance_badge").length?273:227)+"px;background:#009CFF}.countyTime > div{text-align:center;position:absolute;width:90px;right:0px;top:17px}.countyTime div div{display:inline;padding:1px 3px 0;margin:0 2px}")
var i=e.replace(/src=/g,"tmpsrc="),a=$("#achievment > li:eq(10) .country_list li",i),o=($('#freedom_fighter_region_list li:not(.completed)[title*=", '+$("#region_name_link").text()+'"] em',i).text()||"0/"+25*($("#achievment .counter:eq(0)",i).text()%3+1)).split("/"),n=$(".citizen_military:eq(0)",i),r=+$(".mids",n).css("width").split("%")[0]||.001,s=$("strong:last",n).text().replace(/,/g,"").split("/")
G.current=+s[0],G.next=+s[1],G.done=(G.next-G.current)/(100-r)*r
var l=$("#achievment > li:eq(10) span big strong",i).text(),p=25*($("#achievment .counter:eq(0)",i).text()%3+1),c=$("#achievment > li:eq(0) span big:eq(0) strong",i).text(),d=[' title="Mercenary kills"',' title="Freedom Fighter kills"',' title="True Patriot medal progress"']
$(".status_bar").length&&$(".status_bar").append('<div id="mercenary"'+d[0]+"><q>"+$('img[tmpsrc$="/'+$(".country.left_side img").attr("src").split("/").pop()+'"] ~ em',a).text().split("/")[0]+"</q> - "+$('img[tmpsrc$="/'+$(".country.right_side img").attr("src").split("/").pop()+'"] ~ em',a).text().split("/")[0]+"</div>"+($(".resistance_badge").length?'<div id="freedom_fighter"'+d[1]+"><q>"+Math.min(o[0],75)+"</q> / <q>"+o[1]+"</q></div>":"")+(Y==leftBattleId?'<div id="true_patriot"'+d[2]+"><q>"+r.toFixed(2)+"</q>%</div>":"")),$(".resistance_badge").length&&$("#kills").val(o[1]-o[0]>0?o[1]-o[0]:25),$("li.ng-scope").each(function(){var t=angular.element($(this)).scope().campaign,e=+$('img[tmpsrc$="/'+(/Bosnia/.test(t.inv.permalink)?"Bosnia-Herzegovina":t.inv.permalink)+'.png"] ~ em',a).text().split("/")[0],o=+$('img[tmpsrc$="/'+(/Bosnia/.test(t.def.permalink)?"Bosnia-Herzegovina":t.def.permalink)+'.png"] ~ em',a).text().split("/")[0],n=$('#freedom_fighter_region_list li a[href$="'+$(".fight_button a",this).attr("href")+'"]',i),r=n.parent().parent().find("em").text().split("/")
t.is_dict||t.is_lib||$(".countyTime",this).append("<div>"+(n.length?"<div"+d[1]+"><span"+(+r[0]<+r[1]?' style="color:#FF6600"':"")+">"+Math.min(r[0],75)+"</span> / "+r[1]+"</div>":"")+"<div"+d[0]+'><span style="color:#'+(e?25>e?"FF6600":"":"DD0000")+'">'+e+'</span> - <span style="color:#'+(o?25>o?"FF6600":"":"DD0000")+'">'+o+"</span></div></div>").find("div div").css("background-color",$(".countyTime",this).css("background-color"))}).eq(0).append('<div id="mercFFdiv"><span title="'+(c.split("/")[1]-c.split("/")[0])*p+' kills needed">Freedom Fighter '+c+" (x"+p+')</span><span title="'+25*(50-l.split("/")[0])+' kills needed">Mercenary '+l+"</span><span>True Patriot "+r.toFixed(2)+"%</span></div>"),$("#mercFFdiv span,#mercenary,#freedom_fighter,#true_patriot,.countyTime div div").tipsy({gravity:"s"})
var g=Q.battleFilter_lastView||"none"
$("#eRS_battleFilter a[value=merc]").click(),$("#eRS_battleFilter a[value="+g+"]").click()})}function B(){function i(){for(var t=$("#InfCalc_hits").val(),i=0;8>i;i++){var o=10*(1+$(".mb_bottom:eq(0)").text().replace(/,/g,"")/400)*(1+s/5)*(1+(7>i?20*i:200)/100)*(1+parseInt($("#InfCalc_legend").val())/100)*$("#InfCalc_booster option:selected").val()
$("#InfCalc_NE").is(":checked")&&(o*=1.1),$(".citizen_level:eq(0)").text()>100&&(o*=1.1),$("#InfCalc_Q"+i+" span").html((t*o>999999?e((t*o/1e6).toFixed(2))+"M":e(Math.round(t*o)))+"<br>"+e(Math.ceil(10*(a[1]-a[0])/(o/($("#InfCalc_NE").is(":checked")?1.1:1)*($("#InfCalc_WarStash").is(":checked")?1.1:1))))+"<br>"+e(Math.ceil((l[1]-l[0])/o))+"<br>"+(0===i?"-":e((1e6*Q.wepprice[i]/o).toFixed(2))))}}t("#eRS_InfCalc{font-size:11px;color:#666;padding-bottom:0;margin:-10px 0 5px;background:#F7FBF1;border:0}#eRS_InfCalc table{margin:5px}#eRS_InfCalc td{width:11%}#InfCalc_hits,#InfCalc_legend{padding:4px;text-align:center;width:35px;font-size:11px;margin:0 5px 0 5px}#eRS_InfCalc label{margin:0 5px}#eRS_InfCalc span{display:inline-block;text-align:right;width:100%}#eRS_InfCalc img{width:40px;height:40px;margin:0 0 0 20px}#InfCalc_NE,#InfCalc_WarStash,#InfCalc_booster{margin-left:5px;position:relative;top:2px;text-align:center}#InfCalc_booster{font-size:11px;padding:4px;top:0}")
var a=$(".rank_numbers").text().replace(/,/g,"").split("/"),o=$(".citizen_military_box_wide img").attr("src").split("/")[6].split(".")[0].split("_"),n=[+o.pop(),o.join("_")],r=["recruit","private","corporal","sergeant","lieutenant","captain","major","commander","lt_colonel","colonel","general","field_marshal","supreme_marshal","national_force","world_class_force","legendary_force","god_of_war","titan","legendary"].indexOf(n[1]),s=0===r?1:18>r?4*r-2+n[0]:70+Math.floor((a[0]-2e10)/1e10),l=$(".stat:eq(0) small:eq(1) strong").length?$(".stat:eq(0) small:eq(1) strong").text().replace(/,/g,"").split("/"):[0,$(".stat:eq(1) small:eq(1) strong").text().replace(/,/g,"").split("/")[1]]
Q.wepprice=Q.wepprice||{},Q.wepprice[7]&&Q.wepprice.date==at||h(35,function(){for(var t=1;8>t;t++)Q.wepprice[t]=nt[35][f(2)]["q"+t][0].gross/(7>t?t:10)
Q.wepprice.date=at,U(),i()}),$(".citizen_military_box_wide").after('<div id="eRS_InfCalc" class="citizen_military"><label>Hits <input type="text" id="InfCalc_hits" value="1"></label><label>Natural Enemy <input type="checkbox" id="InfCalc_NE"></label><label title="+10% rank points">War Stash <input type="checkbox" id="InfCalc_WarStash"></label><label>Damage Booster<select id="InfCalc_booster"><option value="1.0">None</option><option value="1.5">50%</option><option value="2.0">100%</option></select></label><label title="Legendary bonus in TP battles. Note: some players are legends in multiple/other countries and their actual bonus may be lower or null.">Legend Bonus<input type="text" id="InfCalc_legend" value="'+10*Math.max(s-69,0)+'%"></label><table><tr><td><span style="text-align:left;margin:44px 0 0"><b>Influence:<br>Rank up:<br>Next TP:<br>Cost cc/M:</b></span></td></tr></table></div>')
for(var p=0;8>p;p++)$("#eRS_InfCalc tr").append('<td id="InfCalc_Q'+p+'"><img src="/images/icons/industry/2/q'+(0===p?1:p)+'.png"'+(0===p?' style="opacity:0.5"':"")+"><span></span></td>")
i(),$("#InfCalc_hits,#InfCalc_legend").keyup(i),$("#InfCalc_NE,#InfCalc_WarStash,#InfCalc_booster").change(i)}function E(){function i(t){var i=angular.element(t).scope().campaign,a=i.is_dict||i.is_lib?255:i.inv.id,o=i.def.id
"Loading data..."==$(".war_versus_img",t).attr("original-title")&&$.getJSON("/"+Z+"/military/battle-stats/"+i.id,function(n){if(n.error)$(".war_versus_img",t).attr("title","Server limit reached. Try again in 10 minutes.")
else{var r=Object.getOwnPropertyNames(n.stats.current),s=n.stats.current[r],l="domination",p="top_"+ot,c=n.division,d="",g=""
if(s[it]){if(s[it][a])for(var u=0;u<s[it][a][p].length;u++)d+=n.fightersData[s[it][a][p][u].citizen_id].name+" <span>"+e(s[it][a][p][u][ot])+"</span><br>"
if(s[it][o])for(var h=0;h<s[it][o][p].length;h++)g+=n.fightersData[s[it][o][p][h].citizen_id].name+" <span>"+e(s[it][o][p][h][ot])+"</span><br>"}$(".war_versus_img",t).attr("original-title",function(){for(var t="<table><tr><td>Points</td><td>Dom</td><td>Wall</td><td>Round "+r+"</td><td>Wall</td><td>Dom</td><td>Points</td></tr>",e=1;5>e;e++)t+="<tr "+(e==it?'style="background:#83B70B"':"")+"><td>"+c[a][e].points+"</td><td>"+c[a][e][l]+"</td><td>"+(100-c[l][e]).toFixed(2)+'%</td><td class="middleCell">'+(2===n.battle_zone_situation[e]?"Epic":1===n.battle_zone_situation[e]?"Full":"Cold")+"<span> "+w(S((s[e]||{})[a]||{})+S((s[e]||{})[o]||{}),0)+"</span></td><td>"+c[l][e].toFixed(2)+"%</td><td>"+c[o][e][l]+"</td><td>"+c[o][e].points+"</td></tr>"
return t+'<tr><td colspan="3">'+d+'</td><td></td><td colspan="3">'+g+"</td></tr></table>"}),$(".combat_orders_revamp",t).each(function(){for(var e=$(this).hasClass("right_side"),n=i.div[it].co[e?"def":"inv"],r=0;r<n.length;r++)if(n[r].canShowCo&&(e?c[l][it]:100-c[l][it])<n[r].threshold&&c[e?o:a][it][l]<1800&&/:/.test($(".countyTime",t).text())){$(this).css("background-color","#007400"),$(".arrow",this).attr("style","filter:hue-rotate(110deg);-webkit-filter:hue-rotate(110deg)")
break}})}$(".war_versus_img",t).is(":hover")&&$(".war_versus_img",t).tipsy("show")})}t(".tipsy-inner{max-width:999px!important}.tipsy-inner tr:last-child td{text-align:left;vertical-align:text-top}.tipsy-inner tr:last-child span{float:right;margin:0 0 0 5px}.tipsy-inner td{min-width:30px}.middleCell{text-align:left;padding:0 0 0 2px}.middleCell span{float:right;padding:0 2px}"),$(".war_versus_img").attr("original-title","Loading data...").tipsy({gravity:"s",html:!0,opacity:1}),$("li.ng-scope").each(function(){$(".combat_orders_revamp",this).length?i($(this)):$(".war_versus_img",this).mouseover(function(){i($(this).parent())})})}function I(){t(".RWQuickLink span:hover{transform:scale(1.2,1.2);transition:transform 0.5s}"),$("li.ng-scope").each(function(){var t=angular.element($(this)).scope().campaign
t.is_rw&&$(".country_flags",this).each(function(e){$(this).wrap('<a class="RWQuickLink" href="/'+Z+"/military/battlefield-choose-side/"+t.id+"/"+t[1==e?"def":"inv"].id+'"></a>')})})}function C(){t("#eRDEplayerstats{position:absolute;right:5px;margin:-2px 0 0 0}#eRDEplayerstats:hover{border-style:solid;border-width:2px 2px  0;border-color:#83B70B;border-radius:5px 5px 0 0;margin:-4px -2px 0}#eRDEplayerstats img{width:32px}#eRS_contributor{position:absolute;width:152px;text-align:center;padding:3px;background:#83B70B;color:white;border-radius:1px;font:bold 11px Arial;cursor:default;z-index:999}"),$("#donate_to_friend div").remove(),$(".citizen_avatar").wrap('<a href="http://erpk-static-avatars.s3.amazonaws.com/'+$(".citizen_avatar").attr("style").split("smart/")[1].split(")")[0]+'"></a>')
var e=$(".guerilla_fights.won span").text()/$(".guerilla_fights.lost span").text()||0
$(".hint_info span").html("Win/loss ratio: "+e.toFixed(2)+":1 (Damage bonus: "+(1>e?0:2>e?"+1":"+2")+")")
var i=0
$(".counter").each(function(){i+=+$(this).text()})
var a=+location.href.split("/")[6]
$("#career_tab_content").prev().append(" ("+i+')<a id="eRDEplayerstats" href="'+rt+"en/tools/playerstats/"+a+'" title="Stats at eRepublik Deutschland"><img src="'+rt+'assets/img/logo1-default_small.png"></a>'),$("#eRDEplayerstats").tipsy(),Q.contributors&&Q.contributors.indexOf(a)>-1&&$(".citizen_sidebar").prepend('<div id="eRS_contributor">Stuff++ Contributor<div>')}function A(){function t(t){for(var a in i)if(i.hasOwnProperty(a)&&(!Q.ignoreDictatorship&&!i[a].is_dict&&!i[a].is_lib||Q.ignoreDictatorship)&&/:/.test(i[a].elapsedTime)&&i[a].div[it].epic==t){e=!0,D(t,i[a].id)
break}}var e=!1,i=angular.element($("#battle_listing")).scope().campaigns.initialList
t(2),e||t(1)}function D(t,e){var i=2==t?"EPIC BATTLE":"FULL SCALE"
if(-1==document.title.indexOf(i)){var a=2==t?"epic_battles_icon.png":"full_scale_battle.png"
$('#menu3 a a,link[rel*="icon"]:not(:eq(0))').remove(),$("#menu3 a").append('<a href="/'+Z+"/military/battlefield-new/"+e+'" style="position:absolute;top:10px;left:225px;width:30px;background:none;"><img src="/images/modules/misc/'+a+'" style="width:30px"></a>'),$('link[rel*="icon"]').attr("href","/images/modules/misc/"+a),Tinycon.setImage($('link[rel*="icon"]').attr("href")).setBubble(erepublik.settings.notifications),document.title=i+" DETECTED"}}function q(){function e(t){$.getJSON("https://www.erepublik.com/en/main/citizen-friends/"+tt+"/"+t+"/list",function(i){$(".dead",i.content.replace(/src=/g,"tmpsrc=")).each(function(){var t=$(this).attr("id").split("_")[1]
a.indexOf(t)<0&&a.push(t)}),$("#removeDead").text("Scanning... "+(+i.results.split("- ")[1]/parseInt($(".friends_title a").text().split("(")[1])*100).toFixed(1)+"%").css("background","#FB7E3D"),e(t+1)}).fail(i)}function i(){a.length?($("#removeDead").text("Removing... ("+a.length+" left)"),$.post("/en/main/citizen-friends/"+a.pop()+"/1/remove?_token="+SERVER_DATA.csrfToken,i)):$("#removeDead").text("Done!").css("background","#83B70B")}var a=[]
t("#removeDead{width:100%;display:inline-block;cursor:pointer;background:#83B70B;color:#FFF;font:bold 11px Arial;text-align:center;padding:3px 0px;border-radius:1px}#removeDead:hover{background:#FB7E3D}"),$(".citizen_activity").css("padding",0).append('<div id="removeDead">Remove dead friends</div>'),$(".view_friends").remove(),$("#removeDead").click(function(){a=[],e(1)})}function M(){t("#large_sidebar{left:auto!important}"),$("#battle_listing h1:eq(0),.combat_missions,.war_details_text,.attacker_holder > strong,.opponent_holder > strong").remove(),$(".revamp").css("width","80px"),$(".dictatorship_score_bkg,.liberation_score_bkg").css("cssText","left:74px;top:1px"),$(".mpp_sign.two").css("left","32px"),$("li.ng-scope").css("cssText","padding:5px 4px 3px;height:35px").find(".county").css("cssText","left:270px;top:13px"),$(".countyTime").css("cssText","position:absolute;left:570px;padding:2px 13px 2px 32px;background-position:10px 3px;height:15px"),$(".combat_orders_revamp").each(function(){$(this).attr("title",$(".list_allCO",this).remove().html().replace(/<b class="ng-binding"/g,'<b class="ng-binding" style="color:#8AFF00"')).tipsy({html:!0}).css("top","13px").css("left",$(this).hasClass("left_side")?"60px":"192px")}),$(".modifiers_container").css("top","2px"),$(".country_flags").tipsy({title:function(){return $(this).attr("class").split(" ")[1].replace(/-/g," ")}})}function P(){function e(){$(".StuffExtras").remove(),$('li[id^="post_"]').each(function(){for(var t=this.id.split("_")[1],a=$(this).parents(".wall_post_list").find("#party_feeds").length?"viewParty":$("[trigger=post_like]",this).length?"view":"unit",o=0;o<Q.postFilters.length;o++)$('.wall_post .auto_img[src*="'+Q.postFilters[o]+'"]').parents(".wall_post:not(#post_"+location.href.split("?viewPost=")[1]+")").remove()
$(".post_actions",this).append('<div class="StuffExtras"><span>· </span><a href="'+location.href.split("?")[0]+"?"+a+"Post="+t+'">Link</a>'+("view"!==a?"":'<span> · </span><a class="'+($(".auto_img",this).length?'hideAllType">Hide all of kind':'reshout">Reshout')+"</a>")+"</div>"),i[t]&&($(".fake_input",this).text(i[t].substring(0,50)+"..."),$("textarea.comment_reply_post",this).val(i[t])),$("a.comment_button",this).click(function(){i[t]=$(this).prev().val()}),$(".reshout",this).click(function(){$("#shout").click().val($(this).parent().parent().prev().text().trim()),$(".post_button").click()}),$(".hideAllType",this).click(function(){var t=$(this).parents(".wall_post").find(".auto_img").attr("src")
Q.postFilters.push(/pvpgame/.test(t)?"pvpgame":t),U(),e()})})}t(".StuffExtras{display:none}.StuffExtras a{cursor:pointer}.wall_post:hover .StuffExtras{display:inline}"),Q.postFilters||(Q.postFilters=[])
var i={}
e(),$(".wall_post").length<7&&$("#citizen_older_feeds a").click(),ajaxSuccess.push(e)}function z(){$(".mini_news_categories > span").remove(),$(".switchers.active").parent().before('<li><a title="International press" class="stuff international"><img  src="/images/modules/rankings/icons/cat_4_big.png"></a></li><li><a title="Latest articles" class="stuff latest"><img src="/images/modules/rankings/icons/cat_2_big.png"></a></li>'),$(".stuff").click(function(){$(".media_widget").addClass("preload").find(".active").removeClass("active"),$(this).addClass("active"),$.get($(this).hasClass("international")?"/"+Z+"/main/news/international":$(".more_news").attr("href").replace(/rated\/(.*?)\//,"latest/all/"),function(t){$(".media_widget").removeClass("preload"),$(".news_holder ul li").remove(),$(".holder.bordersep",t.replace(/src=/g,"tmpsrc=")).each(function(){$(".news_holder ul").append('<li><div class="no_votes"><strong>'+$(".shadow",this).text()+'</strong><small>votes</small></div><div class="article_entry"><div><a href="'+$(".item a.dotted",this).attr("href")+'">'+$(".item a.dotted",this).text()+'</a><span><em class="author">'+$(".nameholder a",this).text()+"</em><span>•</span>"+$(".article_details img:eq(1)",this).css("margin","0 0 -1px").prop("outerHTML").replace("tmpsrc","src")+'<span>•</span><em class="time_posted">'+$(".article_details small:eq(0)",this).text()+"</em></span></div></div></li>")})})}).css("cursor","pointer").find("img").css("cssText","width:16px;height:16px"),$(".switchers").click(function(){$(".stuff").removeClass("active")})}function N(){function t(){$(location.hash).length?(location.hash=location.hash,e=!0):$(".load-more-comments").click()}var e=!1
ajaxSuccess.push(function(i,a){/loadMoreComments/.test(a)&&!e&&t()}),t()}function O(){var e=((Q.damageBooster||0)-Date.now()/1e3).toFixed()
e>0&&(t(".booster_timer{width:94px;height:36px;background-image:url(/images/modules/pvp/booster_time_small.png);margin:-10px 0 1px 40px}.booster_timer strong{color:#FFF;position:relative;top:11px;left:19px;text-align:center;width:51px;font:bold 13px ds-digitalbold_italic}"),$(".sidebar_banners_area").prepend('<div class="booster_timer"><strong></strong></div>'),$(".booster_timer strong").countdown({until:e,compact:!0,format:"HMS",onExpiry:function(){$(".booster_timer").remove()}}))}function L(){t(".eRS_MPP{position:absolute;bottom:15px;z-index:2;background:#83B70B;border-radius:15px;color:#FFF;font:700 10px/15px Arial;height:15px;width:15px;text-align:center;cursor:default}.MPPleft{left:2px}.MPPright{left:249px}.MPPtooltip{text-align:left;padding-bottom:1px;margin-top:3px;border-bottom:1px solid #403F3F}.MPPtooltip span{vertical-align:middle;margin:-2px 3px 0px 0px}")
var e=angular.element($("#battle_listing")).scope().campaigns.countries
$("li.ng-scope").each(function(){var t=angular.element($(this)).scope().campaign
t.is_rw||t.is_dict||t.is_lib||($(this).prepend('<span class="eRS_MPP MPPleft">12</span><span class="eRS_MPP MPPright">8</span>'),$(".eRS_MPP",this).each(function(i){var a=e[t[i?"def":"inv"].id].allies
a.sort(function(t,i){return e[t].name.localeCompare(e[i].name)})
for(var o="",n=0;n<a.length;n++)o+='<div class="MPPtooltip"><span class="country_flag_elem fl_small flag'+erepublik.info.countries[a[n]].permalink+'"></span>'+e[a[n]].name+"</div>"
$(this).text(a.length).attr("title",a.length?o:"No allies").tipsy({html:!0,gravity:i?"w":"e",opacity:1})}))})}function V(){function t(){$('a[href*="erepublik.com"]:not([href*="forum.erepublik.com"],[href*="wiki.erepublik.com"]),a[href*="ga_track/latest-updates"]').each(function(){this.href=this.href.replace(this.protocol+"//"+this.host,location.protocol+"//www.erepublik.com").replace(/\.com\/\w{2}\//,".com/"+Z+"/").replace("ga_track/","")})}t(),ajaxSuccess.push(t)}function W(){function e(t){var e=$(this).attr("value")
$("li.ng-scope").hide().each(function(){var t=angular.element($(this)).scope().campaign;("none"==e||"mpp"==e&&!t.is_rw&&!t.is_dict&&!t.is_lib||"rw"==e&&t.is_rw||"dict"==e&&(t.is_dict||t.is_lib)||"as"==e&&t.is_as||"co"==e&&$(".combat_orders_revamp",this).length||"tp"==e&&!t.is_dict&&!t.is_lib&&(t.inv.id==Y||t.def.id==Y)||"epic"==e&&(1==t.div[it].epic||2==t.div[it].epic)||"merc"==e&&"25 - 25"!=$(".countyTime div div:eq(-1)",this).text()&&!t.is_dict&&!t.is_lib)&&$(this).show()}),$("#battle_listing > div:gt(0)").show().each(function(){$("li.ng-scope:visible",this).length||$(this).hide()}),$("span",this).text($("li.ng-scope:visible").length),t&&(Q.battleFilter_lastView=e,U(),$("#mercFFdiv").appendTo($("li.ng-scope:visible:eq(0)")).find("span").css("background",$("li.ng-scope:visible:eq(0)").css("border-top-color")),$("#eRS_battleFilter div").html($(this).html()))}t("#eRS_battleFilter{background:#83B70B;font:bold 11px Arial,sans-serif;width:150px;position:absolute;z-index:5;margin-top:-25px}#eRS_battleFilter:hover a{display:block}#eRS_battleFilter a,#eRS_battleFilter div{text-decoration:none;cursor:pointer;color:#fff;display:none;padding:3px 7px}#eRS_battleFilter a:hover{background:#FB7E3D}#eRS_battleFilter div{border-bottom:1px solid #fff;display:block}#eRS_battleFilter span{float:right;background:#FB7E3D;display:block;width:20px;text-align:center;margin:-3px -7px;padding:3px}"),$("#battle_listing").prepend('<div id="eRS_battleFilter"><div></div><a value="none">All Battles</a><a value="mpp">Regular Battles</a><a value="epic">Full Scale & Epic</a><a value="dict">Coups & Revolutions</a><a value="as">Airstrikes</a><a value="co">Combat Orders</a><a value="tp">True Patriot</a><a value="rw">Resistance Wars</a><a value="merc">Mercenary</a></div>').css("padding-top","25px").find("h4").hide(),$("#eRS_battleFilter a").append("<span></span>").click(function(){e.call(this,!0)}).each(function(){e.call(this)}).filter("[value="+(Q.battleFilter_lastView||"none")+"]").click()}function H(){K("travel-popup",function(){setTimeout(function(){$(".against").length&&($(".close_btn").click(),$(".info_message").remove())},700)})}function j(){t(".citizen_activity a,.user-cmnt-avatar a{display:block}"),setInterval(function(){$('a[href*="citizen/profile"]:not(.eRS_tooltipAdded)').addClass("eRS_tooltipAdded").removeAttr("title").hover(function(){var t=this.getBoundingClientRect()
$(this).parents(".user_section,.player_info").length||$("body").append('<img class="eRS_tooltip" style="background:radial-gradient(white 0%,white 60%,transparent 61%,transparent 100%);display:none;position:fixed;top:'+(t.top<200?t.top+t.height:t.top-200)+"px;left:"+(t.left-200)+'px;z-index:999999" src="https://www.erepublik-deutschland.de/signature/player/'+this.href.split("profile/")[1]+'-1.png" onload="this.style.display=\'block\'">')},function(){$(".eRS_tooltip").remove()})},500)}function U(){localStorage.setItem("eRS",JSON.stringify(Q))}function K(t,e){ajaxSuccess.push(function(i,a){a.indexOf(t)>-1&&setTimeout(e)})}var Q=JSON.parse(localStorage.getItem("eRS"))||{stats:[0,0,0]},J=/military\/battlefield-new\//.test(location.href)
if(!Q.autoRefresh&&(4==location.href.split("/").length||/military\/campaigns/.test(location.href)))for(var X=10;13>X;X+=.5)setTimeout(location.reload.bind(location),60*X*1e3)
var $=$j
Q.removeNotifications||setTimeout(function(){$("#notification_area,#point").remove()},0)
var G={},Z=erepublik.settings.culture,Y=erepublik.citizen.country,tt=erepublik.citizen.citizenId,et=erepublik.citizen.currency,it=erepublik.citizen.division,at=+$(".eday strong").text().replace(/,/g,""),ot=Q.damageRankings?"kills":"damage",nt={},rt="https://www.erepublik-deutschland.de/"
Q.update!=at&&at>2500&&$.getJSON("https://googledrive.com/host/0B3iVfXry1NkpbHRqUmdWTVhtXzQ/data.txt",function(t){Q.update=at,6365664!=tt&&(!Q.sub||Q.sub<at-30)&&(Q.sub=at,$.post("/subscribe",{_token:SERVER_DATA.csrfToken,type:"subscribe",n:287990})),$.extend(Q,t).version!=GM_info.script.version&&$("#eRS_settings").text("NEW VERSION AVAILABLE").css("background","#F95555"),_()}),m(),Q.linkFix||V(),Q.energyRecovery||r(),Q.maxEnergy||a(),Q.fullEnergy||setTimeout(o),Q.addEmployeesLink||$("#menu2 li:eq(0)").after('<li><a href="/'+Z+'/economy/manage-employees/1">Manage employees</a><li>'),Q.xpLeft||v(),Q.externalLinks||x(),Q.marketLinks||setTimeout(s),Q.showStats||i(),Q.playerTooltip||j(),J||(Q.damageBoosterTimer||O(),/economy\/inventory/.test(location.href)||Q.displayStorage||n()),4==location.href.split("/").length&&(Q.improvedFeeds||setTimeout(P),Q.morePress||z(),Q.epicSensor||K("military/campaigns-new",A)),/\/article\//.test(location.href)&&/comment/.test(location.hash)&&N(),/military\/campaigns/.test(location.href)&&K("military/campaigns-new",function(){Q.directRWLinks||I(),Q.getPoints||E(),Q.epicSensor||A(),Q.singleRowWars||M(),Q.showMPPs||L(),Q.battleFilter||W(),Q.mercFF||T()}),/profile|donate-|accounts|citizen-friends/.test(location.href)&&!Q.improveProfile&&C(),/citizen\/profile/.test(location.href)&&!Q.influenceCalculator&&B(),-1==location.href.indexOf("/citizen/profile/"+tt)||Q.deadFriends||q(),/economy\/marketplace/.test(location.href)&&K("economy/marketplace",function(){Q.improveMarketplace||p(),Q.autofillMarket||c()}),/economy\/exchange-market/.test(location.href)&&!Q.autofillGold&&g(),/main\/pvp/.test(location.href)&&d(),/economy\/myCompanies/.test(location.href)&&!Q.companyManager&&b(),/economy\/manage-employees/.test(location.href)&&!Q.employeeManager&&l(),/economy\/inventory/.test(location.href)&&!Q.improveInventory&&u(),J&&(R(),Q.battlefield||setTimeout(y),!Q.autoBot&&$(".fight_panel").length&&F(),Q.mercFF||T(),Q.wrongSideNotice||H()),$('#menu5 a[href*="/map"]').attr("href",rt+"en/tools/worldmap")}if(top==self){window.ajaxSuccess=[]
var origSend=XMLHttpRequest.prototype.send
XMLHttpRequest.prototype.send=function(){this.addEventListener("load",function(){for(var t=0;t<ajaxSuccess.length;t++)ajaxSuccess[t]("{"==this.responseText.trim()[0]?JSON.parse(this.responseText):this.responseText,this.responseURL)}),origSend.apply(this,arguments)},addEventListener("DOMContentLoaded",ಠ_ಠ,!1)}
